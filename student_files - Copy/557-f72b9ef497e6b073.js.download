try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="f8f77ccc-5276-451e-96aa-9d2f02ea616c",e._sentryDebugIdIdentifier="sentry-dbid-f8f77ccc-5276-451e-96aa-9d2f02ea616c")}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[557],{26438:function(e,t,r){r.d(t,{v:function(){return g}});var n=r(21770),a=r(46214),s=r(2265),i=r(60256),o=r(90045),l=r(64040),u=r(49131),d=r(49284),c=r(3813);let g=()=>{let e=(0,c.zq)(),t=(0,u.SJ)(),{userData:r}=(0,i.SE)(),g=(0,o.hT)(e=>e.chatMode),{setChatMode:f}=(0,o.VK)(),m=(0,s.useRef)(!1);(0,s.useEffect)(()=>{if(!e||m.current||!r)return;m.current=!0;let t=!0!==r.disable_agent_mode;t&&g===o.jE.DEFAULT?f(o.jE.AGENT):t||g!==o.jE.AGENT||f(o.jE.DEFAULT)},[e,r,g,f]);let{mutate:p}=(0,n.D)({onError:()=>{(0,l.Eo)("Error saving agent mode setting")},onMutate:e=>{f(e?o.jE.AGENT:o.jE.DEFAULT)},mutationFn:async e=>{if(!r)throw Error("Error setting agent mode");a.ZP.capture(d.SL.SETTINGS.AGENT_MODE_DISABLED,{agent_mode_disabled:!e}),await t.put("/user/".concat(r.id),{disable_agent_mode:!e})}});return{agentModeEnabled:e&&g===o.jE.AGENT,isAgentModeDefault:e&&(null==r?void 0:r.disable_agent_mode)!==!0,setAgentMode:p}}},96484:function(e,t,r){r.d(t,{L6:function(){return u},Rc:function(){return l},fm:function(){return i}});var n=r(57437),a=r(2265);let s="editor-mode-store",i=["auto","gpt-4.1","gpt-4.1-mini","bronzeage","o4-mini","gemini-2.5-pro","gemini-2.5-flash","claude-3.5-sonnet","claude-3.7-sonnet","claude-4-sonnet","claude-4-opus","silverleaf","goldrush","kimi-k2","grok-4"],o=(0,a.createContext)(null),l=e=>{let{children:t}=e,[r,i]=(0,a.useState)(()=>null);return(0,a.useEffect)(()=>{null===r?localStorage.removeItem(s):localStorage.setItem(s,JSON.stringify(r))},[r]),(0,n.jsx)(o.Provider,{value:{selectedModel:r,setSelectedModel:i},children:t})},u=()=>{let e=(0,a.useContext)(o);if(!e)throw Error("useGetSelectedChatModel must be used within a ModelSelectorProvider");return e}},72116:function(e,t,r){r.d(t,{Cg:function(){return o},hP:function(){return v},zL:function(){return p}});var n=r(6273),a=r(91351),s=r(21288);let i=new n.XMLParser({ignoreAttributes:!1,preserveOrder:!0,trimValues:!0}),o=e=>null!=e&&"object"==typeof e&&"type"in e&&"tool_use"===e.type&&"name"in e&&"data"in e&&"done"in e;a.Ry({type:a.i0("lov-sql"),lovSql:a.Z_(),done:a.O7()}),a.Ry({type:a.i0("lov-mermaid"),mermaidCode:a.Z_(),done:a.O7()});let l=a.Ry({type:a.i0("lov_action__link"),url:a.Z_(),text:a.Z_()}),u=a.Ry({type:a.i0("lov_action__migrate"),toolUseId:a.Z_().optional(),done:a.O7()}),d=a.Ry({type:a.i0("lov_action__message_prompt"),message:a.Z_(),text:a.Z_()}),c=a.Ry({type:a.i0("lov_action__knowledge")}),g=a.Ry({type:a.i0("lov_action__secret_form"),name:a.Z_()}),f=a.Ry({type:a.i0("lov_action__suggestion"),message:a.Z_(),text:a.Z_()}),m=a.G0([l,u,d,c,g,f]);function p(e){return e.parts.filter(e=>"done"in e&&e.done&&("search_replace_parts"in e||"content"in e)).length}function v(e){let t=[],r=[],n=null,a=!1,l=!1,u=!1,d=!1,c=!1,g=!1,f=!1,p=!1,v=!1,_="",S="",y="",b="",E=null,w="",x="";function C(){var e,C,I,M,k,T,R;let A=y.trim();if("<lov-plan>"===A||"</lov-plan>"===A){y="";return}if(y.trim().startsWith("<lov-tool-use")){let i;v=!0;let o=(b=y).match(/id="([^"]*)"/),l=b.match(/name="([^"]*)"/),u=b.match(/data="((?:[^"\\]|\\.)*)"(?=\s|\/|>)/),d=b.match(/data="(.*)$/),c=b.match(/failed="([^"]*)"/),g=(null==c?void 0:c[1])==="true",f=b.match(/requires-approval="([^"]*)"/),m=(null==f?void 0:f[1])==="true",p=b.match(/user-input="((?:[^"\\]|\\.)*)"/);if(null==p?void 0:p[1])try{let e=p[1].replace(/\\"/g,'"');e=e.replace(/\\\\/g,"\\"),i=JSON.parse(e)}catch(e){s.logging.error("Failed to parse user input",{error:e,userInput:p[1]})}let _=b.match(/duration="([^"]*)"/),S=_?Math.floor(parseFloat(_[1])):void 0;if(void 0!==S&&S<=0&&(S=1),l&&n){let s=u?u[1]:d?d[1]:"",c=s?h(s):{};a&&n&&"parts"in n?n.parts.push({type:"tool_use",id:null!==(e=null==o?void 0:o[1])&&void 0!==e?e:null,name:l[1],data:s,parsedData:c,done:!1,failed:g,duration:S,requiresApproval:m,userInput:i}):(t.push(n),t.push({type:"tool_use",id:null!==(C=null==o?void 0:o[1])&&void 0!==C?C:null,name:l[1],data:s,parsedData:c,done:!1,failed:g,duration:S,requiresApproval:m,userInput:i}),n={type:"text",content:""}),o&&"lov-supabase-migration"===l[1]&&!r.find(e=>"lov_action__migrate"===e.type)&&r.push({type:"lov_action__migrate",done:!1,toolUseId:o[1]})}}else if(v){if(b+=y,y.includes("</lov-tool-use>")){if(v=!1,a&&n&&"parts"in n){let e=n.parts.findLastIndex(e=>"tool_use"===e.type);if(e>=0){let t=n.parts[e];if(t.done=!0,t.id&&"lov-supabase-migration"===t.name){let e=r.find(e=>"lov_action__migrate"===e.type&&e.toolUseId===t.id);e&&"lov_action__migrate"===e.type&&(e.done=!0)}}}else{let e=t.findLastIndex(e=>o(e));if(e>=0){let n=t[e];if(n.done=!0,n.id&&"lov-supabase-migration"===n.name){let e=r.find(e=>"lov_action__migrate"===e.type&&e.toolUseId===n.id);e&&"lov_action__migrate"===e.type&&(e.done=!0)}}}}}else if("<thinking>"===y.trim())a&&n&&"parts"in n?n.parts.push({type:"tool_use",id:null,name:"lov-think",data:"",parsedData:{},done:!1,failed:!1,requiresApproval:!1}):(n&&t.push(n),t.push({type:"tool_use",id:null,name:"lov-think",data:"",parsedData:{},done:!1,failed:!1,requiresApproval:!1}),n={type:"text",content:""}),f=!0,y="";else if("</thinking>"===y.trim()){let e=x.trim(),r={content:e};if(a&&n&&"parts"in n){let t=n.parts.findLastIndex(e=>"tool_use"===e.type&&"lov-think"===e.name);if(t>=0){let a=n.parts[t];a.done=!0,a.data=e,a.parsedData=r}}else{let n=t.findLastIndex(e=>o(e)&&"lov-think"===e.name);if(n>=0){let a=t[n];a.done=!0,a.data=e,a.parsedData=r}}f=!1,x="",y=""}else if("<lov-code>"===y.trim())n&&t.push(n),a=!0,n={parts:[],done:!1};else if("</lov-code>"===y.trim())n&&"done"in n&&(n.done=!0,t.push(n),n=null),a=!1;else if("<lov-sql>"===y.trim())n&&t.push(n),l=!0,n={type:"lov-sql",lovSql:"",done:!1};else if("</lov-sql>"===y.trim())n&&"lovSql"in n&&(n.done=!0,t.push(n),r.find(e=>"lov_action__migrate"===e.type)||r.push({type:"lov_action__migrate",done:!0}),n=null),l=!1;else if("<lov-mermaid>"===y.trim())n&&t.push(n),u=!0,n={type:"lov-mermaid",mermaidCode:"",done:!1};else if("</lov-mermaid>"===y.trim())n&&"mermaidCode"in n&&(n.done=!0,t.push(n),n=null),u=!1;else if(["<lov-actions>","<actions>"].includes(y.trim()))p=!0;else if(["</lov-actions>","</actions>"].includes(y.trim()))p=!1,r.push(...function(e){try{return i.parse(e).map(e=>{try{var t,r,n,a,i,o,l,u,d,c;if("lov-link"in e)return{type:"lov_action__link",url:null===(t=e[":@"])||void 0===t?void 0:t["@_url"],text:null===(n=e["lov-link"])||void 0===n?void 0:null===(r=n[0])||void 0===r?void 0:r["#text"]};if("lov-knowledge"in e)return{type:"lov_action__knowledge"};if("lov-message-prompt"in e)return{type:"lov_action__message_prompt",message:null===(a=e[":@"])||void 0===a?void 0:a["@_message"],text:null===(o=e["lov-message-prompt"])||void 0===o?void 0:null===(i=o[0])||void 0===i?void 0:i["#text"]};if("lov-secret-form"in e)return{type:"lov_action__secret_form",name:null===(l=e[":@"])||void 0===l?void 0:l["@_name"]};if("lov-suggestion"in e)return{type:"lov_action__suggestion",message:null===(u=e[":@"])||void 0===u?void 0:u["@_message"],text:null===(c=e["lov-suggestion"])||void 0===c?void 0:null===(d=c[0])||void 0===d?void 0:d["#text"]};return s.logging.error("Unknown Lov action",{node:e}),null}catch(t){return s.logging.error("Error processing XML node",{error:t,node:e}),null}}).filter(e=>null!==e).reduce((e,t)=>{let r=m.safeParse(t);return r.success?e.push(r.data):s.logging.error("Failed to validate Lov action",{action:t,error:r.error}),e},[])}catch(t){return s.logging.error("Error parsing XML in parseLovActions",{error:t,input:e}),[]}}(w)),w="";else if(y.startsWith('<lov-write file_path="'))d=!0,S=(null===(I=y.match(/"([^"]*)"/))||void 0===I?void 0:I[1])||"",a&&n&&"parts"in n&&n.parts.push({type:"writing_file",file_path:S,content:"",done:!1});else if(y.startsWith('<lov-search-replace file_path="'))c=!0,S=(null===(M=y.match(/"([^"]*)"/))||void 0===M?void 0:M[1])||"",a&&n&&"parts"in n&&n.parts.push({type:"edit",file_path:S,search_replace_parts:[],done:!1});else if(y.startsWith('<lov-delete file_path="'))g=!0,S=(null===(k=y.match(/"([^"]*)"/))||void 0===k?void 0:k[1])||"",a&&n&&"parts"in n&&n.parts.push({type:"delete",file_path:S});else if(y.startsWith('<lov-rename original_file_path="')){let e=(null===(T=y.match(/original_file_path="([^"]*)"/))||void 0===T?void 0:T[1])||"",t=(null===(R=y.match(/new_file_path="([^"]*)"/))||void 0===R?void 0:R[1])||"";a&&n&&"parts"in n&&n.parts.push({type:"rename",original_file_path:e,new_file_path:t})}else if(y.startsWith("<lov-add-dependency>"))_=y.replace("<lov-add-dependency>","").replace("</lov-add-dependency>","").trim(),a&&n&&"parts"in n&&n.parts.push({type:"add_dependency",dependency:_,isDevDependency:!1});else if("</lov-add-dependency>"===y.trim())_="";else if(y.startsWith("<lov-add-dev-dependency>"))_=y.replace("<lov-add-dev-dependency>","").replace("</lov-add-dev-dependency>","").trim(),a&&n&&"parts"in n&&n.parts.push({type:"add_dependency",dependency:_,isDevDependency:!0});else if("</lov-add-dev-dependency>"===y.trim())_="";else if(y.startsWith("<lov-remove-dependency>")){let e=y.replace("<lov-remove-dependency>","").replace("</lov-remove-dependency>","").trim();a&&n&&"parts"in n&&n.parts.push({type:"remove_dependency",removed_dependency:e})}else if("</lov-remove-dependency>"===y.trim())_="";else if("</lov-write>"===y.trim()||"</lov-search-replace>"===y.trim()||"/>"===y.trim()&&g){if(d=!1,c=!1,g=!1,S="",a&&n&&"parts"in n){let e=n.parts[n.parts.length-1];"done"in e&&(e.done=!0)}}else if(a){if(v);else if(n&&"parts"in n){if(n.parts.length>0){let e=n.parts[n.parts.length-1];if(d&&"content"in e)e.content+=y;else if(c&&"search_replace_parts"in e){if("<lov-search>"===y.trim())e.search_replace_parts.push({search:"",replace:""}),E="search";else if("<lov-replace>"===y.trim())E="replace";else if("</lov-search>"===y.trim()||"</lov-replace>"===y.trim())E=null;else{let t=e.search_replace_parts[e.search_replace_parts.length-1];t&&E&&(t[E]+=y)}}else"text"===e.type&&"content"in e?e.content+=y:n.parts.push({type:"text",content:y})}else n.parts.push({type:"text",content:y})}}else l?n&&"lovSql"in n&&(n.lovSql+=y):u?n&&"mermaidCode"in n&&(n.mermaidCode+=y):p?w+=y:f?x+=y:(n&&"content"in n||(n={type:"text",content:""}),"content"in n&&(n.content+=y));y=""}let I=0;for(;I<e.length;){if(l){let t="</lov-sql>",r=e.indexOf(t,I);if(-1===r){y+=e.slice(I),I=e.length;break}y+=e.slice(I,r),C(),y=t,C(),I=r+t.length;continue}if(u){let t="</lov-mermaid>",r=e.indexOf(t,I);if(-1===r){y+=e.slice(I),I=e.length;break}y+=e.slice(I,r),C(),y=t,C(),I=r+t.length;continue}if("<"===e[I]){y&&C();let t=I,r=!1;for(;t<e.length&&!(++t>=e.length);){if('"'===e[t]){t>0&&"\\"===e[t-1]||(r=!r);continue}if(">"===e[t]&&!r)break}t<e.length?(y=e.substring(I,t+1),C(),I=t+1):(y+=e[I],I++)}else y+=e[I],I++}return y&&C(),n&&t.push(n),{parts:t,lovActions:r}}let h=e=>{let t=e.replace(/\\"/g,'"');t=t.replace(/\\\\/g,"\\");try{return JSON.parse(t)}catch(a){let e;let r={},n=/"([^"]+)":\s*(?:"([^"]*)"?|(true|false|null|\d+(?:\.\d+)?))/g;for(;null!==(e=n.exec(t));){let t=e[1],n=void 0!==e[2]?e[2]:e[3];r[t]=n}return r}}},51115:function(e,t,r){r.d(t,{Z:function(){return f}});var n=r(46214),a=r(14438),s=r(60256),i=r(74746),o=r(50126),l=r(37675),u=r(35034),d=r(21288),c=r(88746),g=r(47902);function f(){let{setIsOutOfCreditsDialogOpen:e}=(0,s.SE)(),{removeMessage:t}=(0,i.mx)(),{showErrorDialog:r}=(0,c.t)(),{setShouldShowTipsAndTricksOnDevServerStart:f}=(0,o.pE)(),{setIsSendChatMessageMutationPending:m}=(0,l.Xr)();return{handleChatStreamingError:(s,i)=>{var o,l,c,p,v,h,_;let S;let{lastUserMessageId:y,onErrorHandled:b}=i;if(t(y),"AbortError"!==s.name){if(s instanceof u.O){if(S=s.traceId,429===s.status)d.logging.error("rate_limit_exceeded",{error:s}),(0,g.rI)(),n.ZP.capture("send_chat_request_rate_limit_exceeded"),s.message.includes("We are currently under heavy load, please try again later")?a.Am.error("We are currently under heavy load, please try again later"):r(s.message,!1,S),null==b||b();else if(402===s.status)n.ZP.capture("out_of_credits_dialog_opened"),e(!0),null==b||b();else if(503===s.status)d.logging.error("send_chat_request_service_unavailable",{error:s}),r(("string"==typeof(null===(o=s.response)||void 0===o?void 0:o.details)?s.response.details:void 0)||s.message,!1,S),null==b||b();else if(499===s.status){d.logging.info("send_chat_request_client_closed",{error:s}),null==b||b();return}else{if(s.status>=500?d.logging.error("send_chat_request_internal_error",{error:s}):d.logging.error("send_chat_request_failed",{error:s}),m(!1),f(!1),400===s.status){let e=(null===(p=s.response)||void 0===p?void 0:p.detail)||(null===(v=s.response)||void 0===v?void 0:v.details)||s.message||"Request failed";a.Am.error(e),null==b||b();return}r((null===(l=s.response)||void 0===l?void 0:l.detail)||(null===(c=s.response)||void 0===c?void 0:c.details)||s.message||"Request failed",!1,S),null==b||b()}}else"message"in s&&"type"in s?(d.logging.error("send_chat_request_error",{error:s}),r(s.message,!1)):(d.logging.error("send_chat_request_unknown_reason",{message:null==s?void 0:s.message,stack:null==s?void 0:s.stack,isOnline:navigator.onLine,errorType:s instanceof TypeError?"NetworkError":"ApplicationError",isNetworkError:null==s?void 0:null===(h=s.message)||void 0===h?void 0:h.includes("Failed to fetch"),isCorsError:null==s?void 0:null===(_=s.message)||void 0===_?void 0:_.includes("CORS"),isTimeout:(null==s?void 0:s.name)==="TimeoutError",isAbort:(null==s?void 0:s.name)==="AbortError",isDomException:s instanceof DOMException,error:s}),r()),null==b||b()}}}}},68904:function(e,t,r){r.d(t,{t:function(){return d}});var n=r(46214),a=r(52558),s=r(74746);let i="start-request",o="first-token",l="end-request",u="start-request";function d(){let{authUser:e}=(0,a.Eu)(),t=null==e?void 0:e.uid,{snapshot:{getUserMessageCount:r,getLastUserMessage:d}}=(0,s.mx)();return{createChatRequestPerformanceMeasurer:e=>{var a,s;let{projectId:c}=e,g=1>=r(),f=null!==(s=null===(a=d())||void 0===a?void 0:a.chatOnly)&&void 0!==s&&s,m=()=>performance.getEntriesByName(i,"mark").length>0;return{measureRequestStart:()=>{performance.mark(i)},measureTimeToFirstToken:()=>{if(!m())return;performance.mark(o);let e=performance.measure(u,i,o);n.ZP.capture("time_to_first_token",{duration:e.duration,project_id:c,user_id:t,chat_only:f,is_creation:g})},measureTimeToLastToken:()=>{if(!m())return;performance.mark(l);let e=performance.measure(u,i,l);n.ZP.capture("time_to_last_token",{duration:e.duration,project_id:c,user_id:t,chat_only:f,is_creation:g})}}}}}},92441:function(e,t,r){r.d(t,{m:function(){return c},u:function(){return d}});var n=r(5978),a=r(2265),s=r(52558),i=r(74746),o=r(90045),l=r(74541),u=r(10867);let d='\n<lov-tool-use id="thinking-opt" name="lov-think" data="">\n';function c(){let{authUser:e}=(0,s.Eu)(),t=null==e?void 0:e.uid,{updateMessage:r}=(0,i.mx)(),c=(0,o.hT)(e=>e.chatMode!==o.jE.DEFAULT);return{createOptimisticMessage:(0,a.useCallback)(e=>{var a,s;let{body:i}=e,o={id:i.id,createdAt:new Date,role:"user",type:"userMessage",selectedElements:null!==(a=i.selected_elements)&&void 0!==a?a:[],content:i.message,tags:null!==(s=i.tags)&&void 0!==s?s:[],images:[],containsError:!!i.contains_error,userId:t,optimistImageUrls:i.optimisticImageUrls};if(r(i.id,o,!0),("enabled"===i.agent_mode||!0===i.chat_only||c)&&i.ai_message_id){let e={id:i.ai_message_id,created_at:n.EK.fromDate(new Date),content:d,thinking_time_ms:0,exclude_from_history:!1,message_type:"aiMessage",status:"running",stopped:!1,graph_id:"optimistic-graph-id",role:l.r.role.AI,tag:l.r.tag.INSTANT_MODE_MESSAGE},t=(0,u.AR)(e);t&&"aiMessage"===t.type&&r(t.id,t,!0)}},[r,t,c])}}},78079:function(e,t,r){r.d(t,{os:function(){return T},OU:function(){return R},mo:function(){return M}});var n=r(21770),a=r(6454),s=r(96484),i=r(82176),o=r(21288),l=r(10531),u=r(2925),d=r(50126),c=r(90045),g=r(37675),f=r(20958),m=r(2265),p=r(22076),v=r(29328);let h=e=>{let t=e.map(e=>{let t=JSON.stringify(e);return t.length>1e4?{type:e.type,timestamp:e.timestamp,data:{truncated:!0,originalSize:t.length}}:e}),r=0,n=[];for(let e=t.length-1;e>=0;e--){let a=JSON.stringify(t[e]);if(r+a.length<=1e6)n.unshift(t[e]),r+=a.length;else break}return JSON.stringify(n)};var _=r(74746),S=r(49131),y=r(51115),b=r(14438),E=r(24032),w=r(68904),x=r(92441),C=r(47176),I=r(10867);function M(e){let t=(0,f.C)();return R({...e,repoAccessibilityState:t})}let k={};function T(e,t){return t&&(k[e.id]||(k[e.id]=(0,a.Xm)("aimsg").toString()),e.ai_message_id=k[e.id]),e}function R(e){let{projectId:t,onRepoInaccessible:r,onSubmit:a,autoSwitchToCode:f=!1,onSuccess:M,repoAccessibilityState:k}=e,R=(0,i.dl)(l.P.AgentDefault),A=(0,u.u)(e=>e.currentPage),{setShouldShowTipsAndTricksOnDevServerStart:j}=(0,d.pE)(),{setIsSendChatMessageMutationPending:D}=(0,g.Xr)(),{createChatRequestPerformanceMeasurer:P}=(0,w.t)(),{createSseEventHandler:O}=function(e){let{autoSwitchToCode:t=!1}=e,{updateMessage:r,setLatestStreamedMessage:n,isMessageStopped:a}=(0,_.mx)(),{updateConsoleStateOnStreaming:s}=(0,C.k)({autoSwitchToCode:t});return{createSseEventHandler:()=>{let e="";return t=>{if("message"!==t.type){o.logging.error("received_unknown_chat_sse",{event_type:t.type,event_data:t.data});return}let i=t.data.message;if(a(i.id))return;let l={...i,stopped:!!i.stopped,status:"running"};n(l);let u=(0,I.AR)(l);u&&("aiMessage"===u.type||"userMessage"===u.type)?r(i.id,u,!0):o.logging.error("unknown_message_type",{message:i}),e=s(i,e)}}}}({autoSwitchToCode:f}),{handleChatStreamingError:L}=(0,y.Z)(),{isRepoAccessible:N,removeLatestMessageIfRepoInaccessible:U}=function(){let{restoreEditorState:e}=(0,E.WR)(),{removeMessage:t}=(0,_.mx)(),r=(0,m.useCallback)(e=>!e||(null==e?void 0:e.accessibility)==="repo_accessible"||(null==e?void 0:e.accessibility)==="repo_not_found",[]),n=r=>{let{onRepoInaccessible:n,latestMessageId:a}=r;null==n||n(),e(),b.Am.error("We couldn't access this project repository."),a&&t(a)};return{isRepoAccessible:r,removeLatestMessageIfRepoInaccessible:(e,t,a)=>{r(e)||n({onRepoInaccessible:a,latestMessageId:t})}}}(),{sendChatRequest:q}=function(){let{prepareMessageDiagnostics:e}=function(){let e=(0,p.D)(),{store:t}=(0,v.My)();return{prepareMessageDiagnostics:(0,m.useCallback)(r=>{let{runtimeErrors:n,latestBuildTimestamp:a}=e.store.getState(),s=t.getState().rrwebEvents;r.session_replay=h(s);let i=t.getState().consoleLogs.length,o=t.getState().networkRequests.length;r.client_logs=[...t.getState().consoleLogs.slice(Math.max(i-50,0),i)],r.network_requests=[...t.getState().networkRequests.slice(Math.max(o-50,0),o)],r.runtime_errors=[...n].filter(e=>e.timestamp>=a),e.clearDiagnostics(),t.setState(e=>{e.consoleLogs=[],e.networkRequests=[],e.rrwebEvents=[]})},[e,t])}}(),{addAbortController:t,removeAbortController:r}=(0,_.mx)();return{sendChatRequest:async n=>{let{projectId:a,body:s,onStart:i,onComplete:o}=n;e(s);let l=new AbortController;t(l),null==i||i();let u=(0,S.SJ)();try{await u.postWithStreaming("/projects/".concat(a,"/chat"),s,()=>{l.abort()},l.signal)}finally{null==o||o(),r(l)}}}}(),{createOptimisticMessage:F}=(0,x.m)(),Z=(0,c.hT)(e=>e.chatMode!==c.jE.DEFAULT),W=(0,c.hT)(e=>e.chatMode===c.jE.AGENT),{selectedModel:V}=(0,s.L6)(),B=async(e,n)=>{e.current_page=A,"enabled"!==e.agent_mode&&(e.agent_mode=W?"enabled":"disabled"),"auto"!==V&&(e.model=V),R&&(e.agent_mode="enabled");let a=n||t;if(!a){o.logging.error("Project ID is required to send chat message");return}let{measureRequestStart:s,measureTimeToFirstToken:i}=P({projectId:a});if(!N(k)){var l;U(k,null!==(l=e.id)&&void 0!==l?l:void 0,r);return}await q({projectId:a,body:e,onMessage:O(),onStart:s,onFirstEvent:i})};return(0,n.D)({mutationFn:async e=>{let{body:r,projectId:n,isCreation:a}=e;D(!0),a&&j(!0);let s=n||t;if(!s){o.logging.error("Project ID is required to send chat message");return}return B(T(r,Z),s)},onMutate:e=>{let{body:t,clear:r}=e;F({body:T(t,Z)}),null==a||a(t.message),null==r||r()},onSuccess:()=>{null==M||M()},onError:(e,t)=>{let{body:r,restore:n}=t;return L(e,{lastUserMessageId:r.id,onErrorHandled:n})}})}},47902:function(e,t,r){r.d(t,{Y:function(){return d},ZK:function(){return s},_g:function(){return c},rI:function(){return o}});var n=r(66491),a=r(5978);let s=e=>{if(!e)return!0;let t=e instanceof a.EK?e.toDate():new Date(e);return(new Date().getTime()-t.getTime())/36e5>=24},i="lovable_rate_limit_timestamp",o=()=>{let e=Date.now();localStorage.setItem(i,e.toString())},l=()=>{let e=localStorage.getItem(i);return e?parseInt(e,10):null},u=()=>{localStorage.removeItem(i)},d=()=>{let e=l();if(!e)return{isRateLimited:!1,secondsRemaining:0};let t=Math.max(0,60-Math.floor((Date.now()-e)/1e3));return 0===t?(u(),{isRateLimited:!1,secondsRemaining:0}):{isRateLimited:!0,secondsRemaining:t}},c=e=>{let t=new Date;return e.getFullYear()===t.getFullYear()?(0,n.WU)(e,"hh:mm a 'on' MMM dd"):(0,n.WU)(e,"hh:mm a 'on' MMM dd yyyy")}},10867:function(e,t,r){r.d(t,{AR:function(){return l},Fd:function(){return d},Oh:function(){return u}});var n=r(5978),a=r(6454),s=r(21288);let i=[],o=e=>"string"==typeof e?new Date(e):e instanceof n.EK?e.toDate():new n.EK(e.seconds,e.nanoseconds).toDate(),l=(e,t)=>{var r,n,a,l,u,d,c,g,f,m,p,v,h,_,S,y,b,E,w,x,C,I,M,k,T;switch(e.tag){case"instant-mode-message":if("user"===e.role)return{createdAt:o(e.created_at),role:"user",id:e.id,content:e.content,type:"userMessage",selectedElements:null!==(r=e.selected_elements)&&void 0!==r?r:i,images:null!==(n=e.images)&&void 0!==n?n:i,containsError:null!==(a=e.contains_error)&&void 0!==a&&a,tags:null!==(l=e.tags)&&void 0!==l?l:i,userId:null!==(u=e.user_id)&&void 0!==u?u:void 0,chatOnly:null!==(d=e.chat_only)&&void 0!==d&&d,isStuck:null!==(c=e.is_stuck)&&void 0!==c&&c,isSecurityReview:null!==(g=e.is_security_review)&&void 0!==g&&g};return{createdAt:o(e.created_at),role:"ai",id:e.id,content:e.content,type:"aiMessage",editId:null!==(m=e.edit_id)&&void 0!==m?m:void 0,stopped:!!e.stopped,errors:null!==(p=null===(f=e.errors)||void 0===f?void 0:f.sort((e,t)=>t.created_at.seconds-e.created_at.seconds))&&void 0!==p?p:void 0,sqlRunState:null!==(v=e.sql_run_state)&&void 0!==v?v:void 0,persisted:null!==(h=null==t?void 0:t.persisted)&&void 0!==h&&h,status:null!==(_=e.status)&&void 0!==_?_:"completed",thinkingTimeMs:null!==(S=e.thinking_time_ms)&&void 0!==S?S:void 0,timeToFirstTokenMs:null!==(y=e.time_to_first_token_ms)&&void 0!==y?y:void 0,feedbackSentiment:null!==(b=e.feedback_sentiment)&&void 0!==b?b:void 0,feedbackContent:null!==(E=e.feedback_content)&&void 0!==E?E:void 0,feedbackCategory:null!==(w=e.feedback_category)&&void 0!==w?w:void 0,costCredits:null!==(x=e.cost_credits)&&void 0!==x?x:void 0};case"branch-switched":return{createdAt:o(e.created_at),id:e.id,type:"branchSwitched",branchName:e.branch_name};case"external-commit-pushed":return{createdAt:o(e.created_at),id:e.id,type:"userCommit",shortCommitHash:null!==(C=e.commit_hash)&&void 0!==C?C:void 0,commitMessage:e.commit_message};case"revert-success":return{createdAt:o(e.created_at),id:e.id,type:"revertSuccess",shortCommitHash:null!==(I=e.commit_hash)&&void 0!==I?I:void 0,editId:null!==(M=e.edit_id)&&void 0!==M?M:""};case"manual-edit":return{createdAt:o(e.created_at),id:e.id,type:"manualEdit",content:e.content,editId:e.edit_id,errors:null!==(T=null===(k=e.errors)||void 0===k?void 0:k.sort((e,t)=>t.created_at.seconds-e.created_at.seconds))&&void 0!==T?T:void 0};case"revert":if("user"===e.role)return{createdAt:o(e.created_at),id:e.id,type:"userMessage",content:e.content,containsError:!1,tags:[],images:[],selectedElements:[],userId:e.user_id,role:"user"};return{createdAt:o(e.created_at),id:e.id,type:"aiMessage",content:e.content,role:"ai",persisted:!0,status:"completed",sqlRunState:void 0,stopped:!1};default:return s.logging.error("Unknown message tag",{message:e}),null}},u=(e,t)=>{let r={};return e.forEach(e=>{let n=e.data(),a=l(n,t);a&&(r[n.id]=a)}),r},d=()=>(0,a.Xm)("umsg").toString()},88746:function(e,t,r){r.d(t,{Y:function(){return g},t:function(){return c}});var n=r(57437),a=r(46214),s=r(2265),i=r(59625),o=r(62869),l=r(26110),u=r(57346),d=r(67817);let c=(0,i.Ue)(e=>({open:!1,errorMessage:null,showTryAgain:!0,traceId:null,showErrorDialog:function(t){let r=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=arguments.length>2?arguments[2]:void 0;return a.ZP.capture("error_dialog_shown",{error_message:t,show_try_again:r,trace_id:n}),e({open:!0,errorMessage:t,showTryAgain:r,traceId:n})},closeError:()=>e({open:!1,errorMessage:null,showTryAgain:!0,traceId:null})}));function g(){let{open:e,errorMessage:t,closeError:r,showTryAgain:i,traceId:g}=c(),[f,m]=(0,s.useState)(!1),p=(0,d.v)(),v=async()=>{if(g)try{await navigator.clipboard.writeText(g),m(!0),setTimeout(()=>m(!1),2e3)}catch(e){console.error("Failed to copy trace ID: ",e)}},h=()=>g?"https://lovable.grafana.net/a/grafana-exploretraces-app/explore?from=now-24h&to=now&timezone=browser&var-ds=grafanacloud-traces&var-primarySignal=nestedSetParent%3C0&var-filters=&var-metric=rate&var-groupBy=resource.service.name&var-spanListColumns=&var-latencyThreshold=&var-partialLatencyThreshold=&actionView=breakdown&traceId=".concat(g):"";return(0,n.jsx)(l.Vq,{open:e,onOpenChange:e=>{e||(a.ZP.capture("error_dialog_closed",{action:"backdrop",error_message:t,trace_id:g}),r())},children:(0,n.jsxs)(l.cZ,{children:[(0,n.jsxs)(l.fK,{className:"text-left",children:[(0,n.jsx)(l.$N,{className:"text-left",children:"Error"}),(0,n.jsxs)(l.Be,{className:"flex flex-col items-start",children:[(t||"An unexpected error occurred. ").split("\n").map((e,r)=>(0,n.jsxs)("span",{children:[e,r!==(t||"An unexpected error occurred. ").split("\n").length-1&&(0,n.jsx)("br",{})]},r)),i&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("br",{}),(0,n.jsx)("span",{children:"Please try again later."})]}),g&&(0,n.jsx)("div",{className:"mt-2 w-full text-[10px] text-muted-foreground/70",children:(0,n.jsxs)("div",{className:"flex flex-wrap items-center gap-1",children:[(0,n.jsx)("p",{children:"ID:"}),(0,n.jsx)("code",{className:"relative break-all rounded bg-muted/50 px-[0.2rem] font-mono",children:g}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)(o.z,{variant:"link",size:"icon-xs",className:"p-0 text-muted-foreground/70 hover:text-muted-foreground focus:ring-0 focus-visible:ring-0 focus-visible:ring-offset-0",onClick:v,"aria-label":"Copy Trace ID",tabIndex:-1,children:(0,n.jsx)(u.Z,{name:f?"check":"content_copy",size:"small"})}),p&&(0,n.jsx)(o.z,{variant:"link",size:"icon-xs",className:"p-0 text-muted-foreground/70 hover:text-muted-foreground focus:ring-0 focus-visible:ring-0 focus-visible:ring-offset-0",onClick:()=>window.open(h(),"_blank"),"aria-label":"View in Grafana",tabIndex:-1,children:(0,n.jsx)(u.Z,{name:"monitoring",size:"small"})})]})]})})]})]}),(0,n.jsx)("div",{className:"mt-4 flex justify-end gap-2",children:(0,n.jsxs)(l.cN,{className:"flex flex-row justify-end gap-2",children:[(0,n.jsx)(o.z,{variant:"outline",onClick:()=>{a.ZP.capture("error_dialog_closed",{action:"get_help",error_message:t,trace_id:g}),r(),window.open("https://docs.lovable.dev/#stay-connected","_blank")},children:"Get help"}),(0,n.jsx)(o.z,{onClick:()=>{a.ZP.capture("error_dialog_closed",{action:"ok",error_message:t,trace_id:g}),r()},autoFocus:!0,children:"Dismiss"})]})})]})})}},2925:function(e,t,r){r.d(t,{u:function(){return n}});let n=(0,r(59625).Ue)(e=>({currentPage:"index",setCurrentPage:t=>e({currentPage:t})}))},47176:function(e,t,r){r.d(t,{k:function(){return i}});var n=r(50126),a=r(72116),s=r(29328);function i(e){let{autoSwitchToCode:t=!1}=e,r=(0,n.Sl)(e=>e.consoleContentType),{store:i,setActiveMessageId:o,setShowConsole:l,setConsoleCodeContent:u,exitConsole:d}=(0,n.pE)(),{store:c}=(0,s.My)(),g=(e,r)=>(e.content.includes("</lov-code>")&&!r.includes("</lov-code>")?(d(),c.setState(e=>{e.consoleLogs=[],e.rrwebEvents=[]})):e.content.includes("<lov-code>")&&!r.includes("<lov-code>")&&t&&(l("code"),e.id&&o(e.id)),r),f=(e,t)=>{if(!e.content)return t;let r=i.getState().activeMessageId;if(e.id===r){for(let t of(0,a.hP)(e.content).parts)if("parts"in t)return u(t),e.content}return t};return{consoleContentType:r,updateConsoleStateOnStreaming:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=t;return r=g(e,r),r=f(e,r)}}}},74746:function(e,t,r){r.d(t,{ei:function(){return f},aM:function(){return M},mx:function(){return k},aK:function(){return T},tV:function(){return R},uO:function(){return A},$m:function(){return P},iY:function(){return D},IE:function(){return j},Fm:function(){return O}});var n=r(57437),a=r(2265),s=r(2043),i=r(37675),o=r(5978),l=r(78099);function u(e){let{array:t,batchSize:r}=e;return Array.from({length:Math.ceil(t.length/r)},(e,n)=>t.slice(n*r,(n+1)*r))}var d=r(21288);let c=e=>{let t={};return e.forEach((e,r)=>{var n,a,s,i,o,l,u,d,c;let g=e.data(),f={id:g.id,commit_sha:null!==(n=g.commit_sha)&&void 0!==n?n:"unknown",commit_message:null!==(a=g.commit_message)&&void 0!==a?a:"unknown",created_at:g.created_at,reverted:null!==(s=g.reverted)&&void 0!==s&&s,type:g.type,diff:null!==(i=g.diff)&&void 0!==i?i:null,status:null!==(o=g.status)&&void 0!==o?o:null,previewBuildStatus:null!==(l=g.preview_build_status)&&void 0!==l?l:null,bookmarked:null!==(u=g.bookmarked)&&void 0!==u&&u,revert_target_edit_id:null!==(d=g.revert_target_edit_id)&&void 0!==d?d:void 0,pages:null!==(c=g.pages)&&void 0!==c?c:[]};t[f.id]=f}),t};var g=r(10867);let f={FIRESTORE_BATCH_SIZE:30,COOLDOWN_TIME_MS:300,MESSAGES_PAGE_SIZE:30,EDIT_PAGE_SIZE:30};var m=r(10418),p=r(59625),v=r(14884);(0,m.MD)();let h=()=>(0,p.Ue)()((0,v.n)(e=>({sortedMessageIds:[],messages:{},edits:{},selectedImageUrl:void 0,imageUrlCache:{},loadingMessagesStatus:"idle",loadingEditsStatus:"idle",isInitialized:!1,hasOlderMessages:!0,hasOlderEdits:!0,canLoadMoreMessages:!0,canLoadMoreEdits:!0,stoppedMessageIds:new Set,latestStreamedMessage:void 0,abortControllers:[]})));function _(e,t){var r;return null!==(r=Object.values(e.messages).find(e=>"aiMessage"===e.type&&e.editId===t))&&void 0!==r?r:null}function S(e,t){var r;return null!==(r=Object.values(e.messages).find(e=>"userCommit"===e.type&&e.shortCommitHash===t))&&void 0!==r?r:null}function y(e,t){return Object.values(e.edits).find(e=>e.commit_sha.startsWith(t))||null}function b(e){var t,r;return null!==(r=null===(t=Object.values(e.edits).sort((e,t)=>{let r=e.created_at.toDate().getTime();return t.created_at.toDate().getTime()-r}).find(e=>!!e.pages&&!!e.pages.length))||void 0===t?void 0:t.pages)&&void 0!==r?r:null}function E(e){let{messages:t,sortedMessageIds:r}=e;for(let e=r.length-1;e>=0;e--){var n;let a=r[e];if((null===(n=t[a])||void 0===n?void 0:n.type)==="userMessage")return t[a]}return null}function w(e){let{messages:t,sortedMessageIds:r}=e;for(let e=r.length-1;e>=0;e--){var n;let a=r[e];if((null===(n=t[a])||void 0===n?void 0:n.type)==="aiMessage")return{messageId:a,message:t[a]}}return null}var x=r(96771),C=r(74541);let I=(0,a.createContext)(null),M=e=>{let{projectId:t,messageId:r,children:m}=e,p=(0,a.useRef)(h()),v=function(e){let{projectId:t}=e;return(0,a.useMemo)(()=>(0,o.IO)((0,o.hJ)(l.db,"projects",t,"trajectory"),(0,o.Xo)("created_at","desc")),[t])}({projectId:t}),b=function(e){let{projectId:t}=e;return(0,a.useMemo)(()=>(0,o.IO)((0,o.hJ)(l.db,"projects",t,"edits"),(0,o.ar)("type","in",[x.I.type.MANUAL_UPDATE,x.I.type.AI_UPDATE,x.I.type.DEVELOPER_UPDATE,x.I.type.REVERT]),(0,o.Xo)("created_at","desc")),[t])}({projectId:t}),w=function(e){let{projectId:t,messageId:r}=e;return(0,a.useMemo)(()=>r?(0,o.JU)(l.db,"projects",t,"trajectory",r):null,[t,r])}({projectId:t,messageId:r}),{updateMessage:M,removeMessage:k,isMostRecentMessage:T,getMessageByEditId:R,getUserCommitMessageByShortCommitHash:A,getUserMessageCount:j,getLastUserMessage:D}=function(e){let{storeRef:t}=e,r=(0,a.useCallback)((e,r,n)=>{t.current.getState().isInitialized&&t.current.setState(t=>{let a=t.messages[e],s=a&&n?{...a,content:r.content}:r;"ai"===r.role&&"ai"===s.role&&n&&(s.thinkingTimeMs=r.thinkingTimeMs,s.timeToFirstTokenMs=r.timeToFirstTokenMs);let i=n?[...t.sortedMessageIds.filter(e=>e!==r.id),e]:t.sortedMessageIds;return{messages:{...t.messages,[e]:s},sortedMessageIds:i}})},[t]),n=(0,a.useCallback)(e=>{t.current.setState(t=>{let{[e]:r,...n}=t.messages;return{messages:n,sortedMessageIds:t.sortedMessageIds.filter(t=>t!==e)}})},[t]),s=(0,a.useCallback)(e=>{let r=t.current.getState().sortedMessageIds;return r[r.length-1]===e},[t]),i=(0,a.useCallback)(e=>_(t.current.getState(),e),[t]);return{updateMessage:r,removeMessage:n,isMostRecentMessage:s,getMessageByEditId:i,getUserCommitMessageByShortCommitHash:(0,a.useCallback)(e=>S(t.current.getState(),e),[t]),getUserMessageCount:(0,a.useCallback)(()=>Object.values(t.current.getState().messages).filter(e=>"userMessage"===e.type).length,[t]),getLastUserMessage:(0,a.useCallback)(()=>E(t.current.getState()),[t])}}({storeRef:p}),{loadEarlierMessages:P,loadMessagesFromId:O,earliestMessageDocRef:L,processMessagesWithEdits:N}=function(e){let{storeRef:t,projectId:r,messagesQuery:n}=e,s=(0,a.useRef)(null),i=(0,a.useCallback)(async e=>{if(0===e.length)return{};let t=u({array:e,batchSize:f.FIRESTORE_BATCH_SIZE});return(await Promise.all(t.map(async e=>c((await (0,o.PL)((0,o.IO)((0,o.hJ)(l.db,"projects",r,"edits"),(0,o.ar)("id","in",e)))).docs)))).reduce((e,t)=>({...e,...t}),{})},[r]),m=(0,a.useCallback)(async(e,t)=>{let r=(0,g.Oh)(e,t),n=e.map(e=>e.data().edit_id).filter(e=>!!e);return{messages:r,edits:await i(n)}},[i]),p=(0,a.useCallback)((e,r)=>{let{messages:n,edits:a}=r,i=e.map(e=>e.id);t.current.setState(e=>({messages:{...e.messages,...n},edits:{...e.edits,...a},sortedMessageIds:[...i,...e.sortedMessageIds]})),e.length>0&&(s.current=e[0])},[t]),v=(0,a.useCallback)(async()=>{let e=t.current.getState();if(s.current&&e.canLoadMoreMessages){t.current.setState({loadingMessagesStatus:"loading",canLoadMoreMessages:!1});try{let e=(await (0,o.PL)((0,o.IO)(n,(0,o.TQ)(s.current),(0,o.b9)(f.MESSAGES_PAGE_SIZE)))).docs.reverse();if(e.length>0){s.current=e[0];let r=await m(e,{persisted:!0});t.current.setState(t=>({messages:{...t.messages,...r.messages},edits:{...t.edits,...r.edits},hasOlderMessages:e.length>=f.MESSAGES_PAGE_SIZE,sortedMessageIds:[...e.map(e=>e.id),...t.sortedMessageIds]}))}else t.current.setState({hasOlderMessages:!1});t.current.setState({loadingMessagesStatus:"success"})}catch(e){t.current.setState({loadingMessagesStatus:"error"}),d.logging.warn("Firestore error - useMessageDataFetching - loadEarlierMessages",{error:e})}finally{setTimeout(()=>{t.current.setState({canLoadMoreMessages:!0})},f.COOLDOWN_TIME_MS)}}},[n,t,m]),h=(0,a.useCallback)((e,r)=>{let n=t.current.getState();return"message_id"===r?n.messages[e]:"shortCommitHash"===r?S(n,e):_(n,e)},[t]),y=(0,a.useCallback)(async e=>{let t=(0,o.IO)(n,(0,o.Lx)(s.current||void 0),(0,o.b9)(1e3)),r=(await (0,o.PL)(t)).docs.reverse(),a=await m(r,{persisted:!0});p(r,a)},[n,m,p]),b=(0,a.useCallback)(async(e,t)=>{let r=(0,o.IO)(n,(0,o.ar)("message_id"===t?"id":"edit_id","==",e),..."message_id"===t?[(0,o.b9)(1)]:[]),a=await (0,o.PL)(r);if(!a.docs[0])return;let i="message_id"===t?a.docs[0]:a.docs.find(e=>e.data().tag===C.r.tag.INSTANT_MODE_MESSAGE);if(!i)return;let l=(0,o.IO)(n,(0,o.Lx)(i),(0,o.TQ)(s.current||void 0)),u=[i,...(await (0,o.PL)(l)).docs.reverse()],d=await m(u,{persisted:!0});p(u,d)},[n,m,p]);return{fetchEditsForMessages:i,processMessagesWithEdits:m,loadEarlierMessages:v,loadMessagesFromId:(0,a.useCallback)(async e=>{let{messageId:r,id_type:n="edit_id"}=e,a=h(r,n),s=t.current.getState();if(!(a&&s.sortedMessageIds.includes(a.id))){t.current.setState({loadingMessagesStatus:"loading"});try{"shortCommitHash"===n?await y(r):await b(r,n),t.current.setState({loadingMessagesStatus:"success"})}catch(e){t.current.setState({loadingMessagesStatus:"error"}),console.error("Error loading messages from ID",{error:e,messageId:r,id_type:n})}}},[h,y,b,t]),earliestMessageDocRef:s}}({storeRef:p,projectId:t,messagesQuery:v}),{loadEarlierEdits:U,earliestEditDocRef:q,fetchMessagesForEdits:F}=function(e){let{storeRef:t,projectId:r,editsQuery:n}=e,s=(0,a.useRef)(null),i=(0,a.useCallback)(async e=>{if(0===e.length)return{};let t=u({array:e,batchSize:f.FIRESTORE_BATCH_SIZE});return(await Promise.all(t.map(async e=>{let t=await (0,o.PL)((0,o.IO)((0,o.hJ)(l.db,"projects",r,"trajectory"),(0,o.ar)("edit_id","in",e)));return(0,g.Oh)(t.docs,{persisted:!0})}))).reduce((e,t)=>({...e,...t}),{})},[r]);return{loadEarlierEdits:(0,a.useCallback)(async()=>{if(s.current&&t.current.getState().canLoadMoreEdits){t.current.setState({loadingEditsStatus:"loading",canLoadMoreEdits:!1});try{let e=(await (0,o.PL)((0,o.IO)(n,(0,o.TQ)(s.current),(0,o.b9)(f.EDIT_PAGE_SIZE)))).docs;if(e.length>0){s.current=e[e.length-1];let r=c(e),n=Object.keys(r),a=await i(n);t.current.setState(t=>({edits:{...t.edits,...r},messages:{...t.messages,...a},hasOlderEdits:e.length>=f.EDIT_PAGE_SIZE}))}else t.current.setState({hasOlderEdits:!1});t.current.setState({loadingEditsStatus:"success"})}catch(e){t.current.setState({loadingEditsStatus:"error"}),d.logging.warn("Firestore error - useEditOperations - loadEarlierEdits",{error:e})}finally{setTimeout(()=>{t.current.setState({canLoadMoreEdits:!0})},f.COOLDOWN_TIME_MS)}}},[n,t,i]),earliestEditDocRef:s,fetchMessagesForEdits:i}}({storeRef:p,projectId:t,editsQuery:b}),{getEditByShortCommitHash:Z,updateEdit:W}=function(e){let{storeRef:t}=e;return{getEditByShortCommitHash:(0,a.useCallback)(e=>y(t.current.getState(),e),[t]),updateEdit:(0,a.useCallback)((e,r)=>{t.current.setState(t=>{if(t.edits[e]){let n={...t.edits};return n[e]={...n[e],...r},{edits:n}}return t})},[t])}}({storeRef:p}),{cacheImageUrl:V,setSelectedImageUrl:B}=function(e){let{storeRef:t}=e;return{cacheImageUrl:(0,a.useCallback)((e,r)=>{t.current.setState(t=>({imageUrlCache:{...t.imageUrlCache,[e]:r}}))},[t]),setSelectedImageUrl:(0,a.useCallback)(e=>{t.current.setState({selectedImageUrl:e})},[t])}}({storeRef:p}),{subscriptionBoundaryTime:G}=function(e){let{storeRef:t,messagesQuery:r,editsQuery:n,processMessagesWithEdits:s}=e,i=(0,a.useRef)(o.EK.now());return(0,a.useEffect)(()=>{let e=t.current,a=(0,o.cf)((0,o.IO)(r,(0,o.ar)("created_at",">=",i.current)),async t=>{let r=[...t.docs].reverse(),n=(0,g.Oh)(r,{persisted:!0});e.setState(e=>{let t=new Set(e.sortedMessageIds),a=r.map(e=>e.id).filter(e=>!t.has(e));return{messages:{...e.messages,...n},sortedMessageIds:[...e.sortedMessageIds,...a]}})}),s=(0,o.cf)((0,o.IO)(n,(0,o.ar)("created_at",">=",i.current)),t=>{let r=c([...t.docs]);e.setState(e=>({...e,edits:{...e.edits,...r}}))});return()=>{a(),s()}},[r,n,t,s]),{subscriptionBoundaryTime:i}}({storeRef:p,messagesQuery:v,editsQuery:b,processMessagesWithEdits:N}),z=(0,a.useCallback)(e=>{p.current.setState(t=>({...t,isInitialized:e}))},[p]),{loadInitialData:J}=function(e){let{storeRef:t,messagesQuery:r,editsQuery:n,subscriptionBoundaryTime:s,earliestMessageDocRef:i,earliestEditDocRef:l,processMessagesWithEdits:u,fetchMessagesForEdits:d,messageId:g,specificMessageQuery:m}=e;return{loadInitialData:(0,a.useCallback)(async()=>{let e;if(g&&m){let t=await (0,o.QT)(m);e=t.exists()?await (0,o.PL)((0,o.IO)(r,(0,o.ar)("created_at","<",s.current),(0,o.Wu)(t))):await (0,o.PL)((0,o.IO)(r,(0,o.ar)("created_at","<",s.current),(0,o.b9)(f.MESSAGES_PAGE_SIZE)))}else e=await (0,o.PL)((0,o.IO)(r,(0,o.ar)("created_at","<",s.current),(0,o.b9)(f.MESSAGES_PAGE_SIZE)));let a=e.docs.reverse();a.length>0&&(i.current=a[0]);let{messages:p,edits:v}=await u(a,{persisted:!0}),h=await (0,o.PL)((0,o.IO)(n,(0,o.ar)("created_at","<",s.current),(0,o.b9)(f.EDIT_PAGE_SIZE)));h.docs.length>0&&(l.current=h.docs[h.docs.length-1]);let _=c(h.docs),S=c((await (0,o.PL)((0,o.IO)(n,(0,o.ar)("bookmarked","==",!0)))).docs),y=Object.keys(S),b={};y.length>0&&(b=await d(y)),t.current.setState(t=>{let r={...t.messages,...p,...b},n=[...new Set([...t.sortedMessageIds,...a.map(e=>e.id)])];return n=n.sort((e,t)=>{let n=r[e],a=r[t];return n.createdAt.getTime()-a.createdAt.getTime()}),{messages:r,hasOlderMessages:e.docs.length>=f.MESSAGES_PAGE_SIZE,edits:{...t.edits,...v,..._,...S},hasOlderEdits:h.docs.length>=f.EDIT_PAGE_SIZE,sortedMessageIds:n,isInitialized:!0}})},[r,n,s,i,l,u,d,t,g,m])}}({storeRef:p,messagesQuery:v,editsQuery:b,subscriptionBoundaryTime:G,earliestMessageDocRef:L,earliestEditDocRef:q,processMessagesWithEdits:N,fetchMessagesForEdits:F,messageId:r,specificMessageQuery:w}),{setLatestStreamedMessage:H,addStoppedMessageId:K,isMessageStopped:X,addAbortController:Y,removeAbortController:$}=function(e){let{storeRef:t}=e;return{setLatestStreamedMessage:(e,r)=>{r&&e?t.current.setState(t=>({...t,sortedMessageIds:[...t.sortedMessageIds,e.id],latestStreamedMessage:e,messages:{...t.messages,[e.id]:e}})):t.current.setState(t=>({...t,latestStreamedMessage:e}))},addStoppedMessageId:e=>{e&&t.current.setState(t=>({...t,stoppedMessageIds:new Set([...t.stoppedMessageIds,e])}))},isMessageStopped:e=>{let r=t.current.getState();return!!r.latestStreamedMessage&&"stopped"in r.latestStreamedMessage&&!!r.latestStreamedMessage.stopped||r.stoppedMessageIds.has(e)},addAbortController:e=>{t.current.setState(t=>({...t,abortControllers:[...t.abortControllers,e]}))},removeAbortController:e=>{t.current.setState(t=>({...t,abortControllers:t.abortControllers.filter(t=>t!==e)}))}}}({storeRef:p}),{setIsSendChatMessageMutationPending:Q}=(0,i.Xr)(),{canEdit:ee}=(0,s.t)();(0,a.useEffect)(()=>{ee&&J()},[J,ee]);let et={store:p.current,updateMessage:M,removeMessage:k,setIsInitialized:z,loadEarlierMessages:P,loadMessagesFromId:O,loadEarlierEdits:U,cacheImageUrl:V,setSelectedImageUrl:B,isMostRecentMessage:T,updateEdit:W,setLatestStreamedMessage:H,addStoppedMessageId:K,isMessageStopped:X,addAbortController:Y,removeAbortController:$,abortRequests:()=>{Q(!1),p.current.getState().abortControllers.forEach(e=>{e.abort()}),p.current.setState(e=>({...e,abortControllers:[]}))},snapshot:{getEditByShortCommitHash:Z,getMessageByEditId:R,getUserCommitMessageByShortCommitHash:A,getUserMessageCount:j,getLastUserMessage:D}};return(0,n.jsx)(I.Provider,{value:et,children:m})};function k(){let e=(0,a.useContext)(I);if(!e)throw Error("useChatContext must be used within a ChatProvider");return e}function T(e){let t=k();if(!t)throw Error("useChatStore must be used within a ChatProvider");return t.store(e)}function R(e){return T(t=>e?t.edits[e]:null)}function A(e){return T(t=>e?y(t,e):null)}function j(){return T(b)}function D(){return T(E)}function P(){return T(w)}function O(e){return T(t=>e?_(t,e):null)}},7455:function(e,t,r){r.d(t,{c:function(){return f},h:function(){return g}});var n=r(57437),a=r(92850),s=r(2265),i=r(59625),o=r(52558),l=r(33187),u=r(77113);let d=()=>(0,i.Ue)(()=>({collaborators:[],accessLevel:null,collaboratorsInitialized:!1,hasFetchedCollaborators:!1})),c=(0,s.createContext)(null),g=e=>{let{children:t,projectId:r}=e,i=(0,s.useRef)(d()),{authUser:g}=(0,o.Eu)(),f=(0,u.iZ)(e=>e.project),{data:m,isFetched:p}=(0,a.a)(l.W.collaborators({projectId:r,projectOwnerId:null==f?void 0:f.user_id}));(0,s.useEffect)(()=>{if(m&&(null==f?void 0:f.user_id)){let e=(0,l.b)({collaborators:m,projectOwnerId:f.user_id});i.current.setState({collaborators:e})}},[m,null==f?void 0:f.user_id]),(0,s.useEffect)(()=>{if(null==g?void 0:g.uid){let e=null==m?void 0:m.find(e=>e.id===(null==g?void 0:g.uid));e&&e.joined_at?i.current.setState({accessLevel:e.access_level}):i.current.setState({accessLevel:null})}},[null==g?void 0:g.uid,m]),(0,s.useEffect)(()=>{p&&i.current.setState({hasFetchedCollaborators:!0})},[p]);let v={store:i.current};return(0,n.jsx)(c.Provider,{value:v,children:t})};function f(e){let{store:t}=function(){let e=(0,s.useContext)(c);if(!e)throw Error("useCollaborationContext must be used within a CollaborationProvider");return e}();return t(e)}},50126:function(e,t,r){r.d(t,{BV:function(){return d},Sl:function(){return g},pE:function(){return c},vD:function(){return o}});var n=r(57437),a=r(2265),s=r(59625),i=r(40878);let o={error:"Error",code:"Code",debug:"Debug",annotation:"Annotation","snapshot-preview":"Snapshot Preview",mermaid:"Mermaid Diagram"},l=()=>(0,s.Ue)(()=>({activeView:"preview",consoleContentType:null,activeMessageId:void 0,activeEditId:void 0,activeConsoleCodeContent:void 0,activeConsoleErrorContent:void 0,activeConsolePreviewContent:void 0,activeConsoleMermaidContent:void 0,shouldShowTipsAndTricksOnDevServerStart:!1})),u=(0,a.createContext)(null),d=e=>{let{children:t}=e,r=(0,a.useRef)(l()),{setIsPreviewDocked:s,setView:o}=(0,i.zp)(),d={store:r.current,setActiveView:e=>{r.current.setState({activeView:e})},setShowConsole:e=>{let t=r.current;"snapshot-preview"!==e&&null!==e&&s(!0),t.setState({consoleContentType:e,activeView:e?"console":"preview"}),o(e?i.$.PREVIEW:i.$.CHAT)},setConsoleContentType:e=>{let t=r.current;t.setState({consoleContentType:e,activeView:e?"console":t.getState().activeView})},setActiveMessageId:e=>{r.current.setState({activeMessageId:e})},setActiveEditId:e=>{r.current.setState({activeEditId:e})},setConsoleCodeContent:e=>{r.current.setState({activeConsoleCodeContent:e})},setConsoleErrorContent:e=>{r.current.setState({activeConsoleErrorContent:e})},setConsolePreviewContent:e=>{r.current.setState({activeConsolePreviewContent:e})},setActiveMermaidContent:e=>{r.current.setState({activeConsoleMermaidContent:e})},setShouldShowTipsAndTricksOnDevServerStart:e=>{r.current.setState({shouldShowTipsAndTricksOnDevServerStart:e})},exitConsole:()=>{r.current.setState({consoleContentType:null,activeView:"preview",activeMessageId:void 0,activeEditId:void 0,activeConsoleErrorContent:void 0,activeConsoleCodeContent:void 0,activeConsolePreviewContent:void 0,activeConsoleMermaidContent:void 0,shouldShowTipsAndTricksOnDevServerStart:!1}),o(i.$.CHAT)}};return(0,n.jsx)(u.Provider,{value:d,children:t})};function c(){let e=(0,a.useContext)(u);if(!e)throw Error("useConsoleContext must be used within a ConsoleProvider");return e}function g(e){let{store:t}=c();return t(e)}},90045:function(e,t,r){r.d(t,{VK:function(){return f},cb:function(){return g},es:function(){return s},hT:function(){return m},jE:function(){return i}});var n,a,s,i,o=r(57437),l=r(2265),u=r(59625);(n=s||(s={})).RAW="RAW",n.DIFF="DIFF",(a=i||(i={})).DEFAULT="default",a.CHAT_ONLY="chat-only",a.AGENT="agent";let d=()=>(0,u.Ue)(()=>({chatMode:"default",codeViewType:"RAW"})),c=(0,l.createContext)(null),g=e=>{let{children:t}=e,r=(0,l.useRef)(d()),n={store:r.current,setChatMode:e=>{let t=r.current;"function"==typeof e?t.setState(t=>({chatMode:e(t.chatMode)})):t.setState({chatMode:e})},setCodeViewType:e=>{r.current.setState({codeViewType:e})}};return(0,o.jsx)(c.Provider,{value:n,children:t})};function f(){let e=(0,l.useContext)(c);if(!e)throw Error("useEditorModeContext must be used within an EditorModeProvider");return e}function m(e){let{store:t}=f();return t(e)}},37675:function(e,t,r){r.d(t,{Xr:function(){return d},bk:function(){return c},pY:function(){return g},vw:function(){return u}});var n=r(57437),a=r(2265),s=r(59625),i=r(14884);let o=()=>(0,s.Ue)()((0,i.n)(e=>({isSendChatMessageMutationPending:!1,isBuildErrorOccurredDuringStream:!1,isSomeRevertMutationPending:!1,editIdToConfirmRestoreFor:void 0}))),l=(0,a.createContext)(null),u=e=>{let{children:t}=e,r=(0,a.useRef)(o()),s={store:r.current,setIsSendChatMessageMutationPending:e=>{r.current.setState({isSendChatMessageMutationPending:e,isBuildErrorOccurredDuringStream:!1})},setIsBuildErrorOccurredDuringStream:e=>{r.current.setState({isBuildErrorOccurredDuringStream:e})},setIsSomeRevertMutationPending:e=>{r.current.setState({isSomeRevertMutationPending:e})},setEditIdToConfirmRestoreFor:e=>{r.current.setState({editIdToConfirmRestoreFor:e})}};return(0,n.jsx)(l.Provider,{value:s,children:t})};function d(){let e=(0,a.useContext)(l);if(!e)throw Error("useMessageSubmissionContext must be used within a MessageSubmissionProvider");return e}function c(e){let{store:t}=d();return t(e)}let g=()=>{let{isSendChatMessageMutationPending:e,isSomeRevertMutationPending:t}=c(e=>e);return e||t}},40878:function(e,t,r){r.d(t,{$:function(){return a},eP:function(){return d},gu:function(){return g},zp:function(){return c}});var n,a,s=r(57437),i=r(2265),o=r(59625);(n=a||(a={})).PREVIEW="preview",n.CHAT="chat";let l=()=>(0,o.Ue)(()=>({view:"chat",isPreviewDocked:!0,showHistoryPanel:!1})),u=(0,i.createContext)(null),d=e=>{let{children:t}=e,r=(0,i.useRef)(l()),n={store:r.current,setView:e=>{let t=r.current;"function"==typeof e?t.setState(t=>({view:e(t.view)})):t.setState({view:e})},setIsPreviewDocked:e=>{let t=r.current;"function"==typeof e?t.setState(t=>({isPreviewDocked:e(t.isPreviewDocked)})):t.setState({isPreviewDocked:e})}};return(0,s.jsx)(u.Provider,{value:n,children:t})};function c(){let e=(0,i.useContext)(u);if(!e)throw Error("useMobileContext must be used within a MobileProvider");return e}function g(e){let{store:t}=c();return t(e)}},29328:function(e,t,r){r.d(t,{i5:function(){return K},wF:function(){return A},g9:function(){return H},XE:function(){return z},My:function(){return j},f6:function(){return D},vE:function(){return P}});var n=r(57437),a=r(92850),s=r(53974),i=r(2265),o=r(14273),l=r(59625),u=r(14884),d=r(88568),c=r(21288);let g=e=>{var t,r,n,a,s,i,o,l;let u=Object.entries(e.headers||{}).reduce((e,t)=>{let[r,n]=t;return e+r.length+String(n).length},0);return((null===(t=e.responseBody)||void 0===t?void 0:t.length)||0)+((null===(r=e.requestBody)||void 0===r?void 0:r.length)||0)+((null===(a=e.error)||void 0===a?void 0:null===(n=a.message)||void 0===n?void 0:n.length)||0)+((null===(i=e.error)||void 0===i?void 0:null===(s=i.stack)||void 0===s?void 0:s.length)||0)+((null===(o=e.url)||void 0===o?void 0:o.length)||0)+((null===(l=e.statusText)||void 0===l?void 0:l.length)||0)+u},f=e=>e.reduce((e,t)=>e+t.message.length,0);var m=r(98015),p=r(65666),v=r(49131),h=r(76906),_=r(22076),S=r(61062),y=r(7163),b=r(48614),E=r(1188),w=e=>{let{isLoading:t}=e,[r,a]=(0,i.useState)(0),[s,o]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{t&&(a(0),o(!0))},[t]),(0,i.useEffect)(()=>{if(!t){a(100);return}let e=[];return[{duration:150,increment:15},{duration:250,increment:10},{duration:400,increment:5},{duration:500,increment:3},{duration:650,increment:3},{duration:750,increment:3},{duration:1500,increment:2},{duration:2e3,increment:1},{duration:3e3,increment:1},{duration:4e3,increment:1},{duration:5e3,increment:1},{duration:6e3,increment:1},{duration:7e3,increment:1},{duration:1e4,increment:1},{duration:14e3,increment:1}].forEach(t=>{let{duration:r,increment:n}=t,s=setTimeout(()=>{a(e=>e<75?e+n+2*Math.random():e)},r);e.push(s)}),()=>{e.forEach(e=>clearTimeout(e))}},[t]),(0,n.jsx)("div",{className:"pointer-events-none absolute left-0 right-0 top-0 h-[3px] w-full overflow-hidden bg-transparent",children:(0,n.jsx)(b.M,{children:s&&(0,n.jsx)(E.E.div,{className:"h-full bg-accent",initial:{width:0,opacity:1},animate:{width:"".concat(Math.min(r,100),"%"),opacity:1},exit:{opacity:0,transition:{delay:.2,duration:.3}},transition:{width:{duration:.15,bounce:0}},onAnimationComplete:()=>{t||o(!1)}})})})};function x(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return"";try{let r=new URL(e);return t.useCustomScript&&r.searchParams.set("lov-override-script","true"),t.accessToken&&r.searchParams.set("__lovable_token",t.accessToken),r.toString()}catch(t){return console.error("Error formatting preview URL:",t),e}}function C(e){if(!e)return null;try{return e.replace("http://","ws://").replace("https://","wss://")}catch(e){return console.error("Error converting to WebSocket URL:",e),null}}var I=r(37675),M=r(27613),k=r(77113);let T=e=>(0,l.Ue)()((0,u.n)(()=>({device:"desktop",customScript:!1,_sandboxState:null,_isSandboxStateStale:!1,isStartingSandboxInTheBackground:!1,targetMode:M.i.STATIC,activeMode:M.i.STATIC,visibleMode:M.i.STATIC,currentPath:"/",baseUrls:{static:(0,h.t)({projectId:e}),live:null},error:null,consoleLogs:[],networkRequests:[],rrwebEvents:[],accessToken:void 0}))),R=(0,i.createContext)(null);function A(e){let{children:t}=e,r=(0,p.D)(),[a]=(0,i.useState)(()=>T(r)),l=(0,i.useRef)(null),u=(0,i.useRef)(null),d=(0,i.useMemo)(()=>({live:l,static:u}),[]),g=a(e=>e.targetMode===M.i.LIVE&&"running"===e._sandboxState?M.i.LIVE:M.i.STATIC);(0,i.useEffect)(()=>{a.setState(e=>{e.activeMode=g})},[g,a]),(0,i.useEffect)(()=>{if("live"!==g){a.setState(e=>{e.visibleMode=M.i.STATIC});return}if("live"===g){let e=setTimeout(()=>{a.setState(e=>{e.visibleMode=M.i.LIVE})},3e3);return()=>clearTimeout(e)}},[g,a]);let f=a(e=>e.targetMode),h=a(e=>e._sandboxState);!function(e){let t=(0,v.SJ)(),r=(0,p.D)(),{setIsBuildErrorOccurredDuringStream:n}=(0,I.Xr)(),a=(0,_.D)(),s=(0,i.useMemo)(()=>{let t=e.enabled&&e.url?new URL(e.url):null;return t?C("".concat(t.protocol,"//").concat(t.host)):null},[e.enabled,e.url]);(0,o.useWebSocket)(s,{protocols:"vite-hmr",share:!0,onMessage:e=>{try{let i=JSON.parse(e.data);if((null==i?void 0:i.type)==="update"){let e=Date.now()-500;a.updateLatestBuildTimestamp(e)}if((null==i?void 0:i.type)==="error"){var s;n(!0),c.logging.info("build_error_from_devserver",{message:null==i?void 0:null===(s=i.err)||void 0===s?void 0:s.message});let e=y.p.safeParse(null==i?void 0:i.err);e.success?(0,m.e)(e.data,r,t):(c.logging.error("error_parsing_devserver_error",{error:e}),(0,m.e)(null==i?void 0:i.err,r,t))}}catch(e){c.logging.error("error_parsing_devserver_error",{error:e})}},onOpen:t=>{var r;null===(r=e.onStatusChange)||void 0===r||r.call(e,"running"),c.logging.debug("devserver_websocket_open")},onClose:t=>{var r;null===(r=e.onStatusChange)||void 0===r||r.call(e,"stopped"),c.logging.debug("devserver_websocket_close")},onError:t=>{var r;null===(r=e.onStatusChange)||void 0===r||r.call(e,"error"),c.logging.error("devserver_websocket_error",{event:t})},shouldReconnect:()=>!0,reconnectInterval:1e3})}({enabled:"live"===f&&"running"===h,url:a(e=>e.baseUrls.live)});let S=e=>{a.setState(t=>{t.device=e})},b=e=>{a.setState(t=>{t.customScript=e})},E=(0,i.useCallback)(()=>{a.setState(e=>{e.targetMode="static",e._sandboxState=null,e._isSandboxStateStale=!0,e.error=null})},[a]),w=(0,i.useCallback)(()=>{a.setState(e=>{("live"!==e.targetMode||"running"!==e._sandboxState||e.error)&&(e.targetMode="live",e._sandboxState="starting",e.error=null,e.isStartingSandboxInTheBackground=!0)})},[a]),x=(0,i.useCallback)(()=>{a.setState(e=>{("live"!==e.targetMode||"running"!==e._sandboxState||e.error)&&(e.targetMode="live",e._sandboxState="starting",e.error=null,e.isStartingSandboxInTheBackground=!1)})},[a]),A=(0,i.useCallback)(e=>{a.setState(e=>{e._sandboxState="starting",e.targetMode="live",e.error=null})},[a]),j=(0,i.useCallback)(()=>{a.setState(e=>{e._sandboxState="error",e.error={type:"dev_server",message:"Sorry, we ran into an issue starting the live preview!"}})},[a]),D=(0,i.useCallback)(async()=>{a.setState(e=>{e._sandboxState="starting",e.error=null});try{let e=(0,v.SJ)(),t=await e.post("/projects/".concat(r,"/sandbox/start"),{project_id:r});a.setState(e=>{t.url&&!t.url.endsWith("/")&&(t.url=t.url+"/"),e.baseUrls.live=t.url,e._isSandboxStateStale=!0})}catch(e){j()}},[r,j,a]),P=(0,i.useCallback)(async e=>{let t=a.getState();if("live"===t.targetMode&&(t.error||"error"===t._sandboxState)){A(),a.setState(t=>{t.currentPath=null!=e?e:"/"});return}if(e)a.setState(t=>{t.currentPath=e});else{var r;null===(r=d[t.targetMode].current)||void 0===r||r.reload()}},[d,A,a]),O=(0,i.useCallback)(()=>{a.setState(e=>{e._sandboxState="running",e.error=null})},[a]),B=(0,i.useMemo)(()=>({store:a,setDevice:S,setCustomScript:b,startLiveMode:x,startLiveModeInBackground:w,restartLiveMode:A,revertToStaticMode:E,refreshPreview:P,refs:d,buildFullPreviewUrl:V}),[]),G=(0,k.iZ)(e=>{var t;return null===(t=e.project)||void 0===t?void 0:t.latest_commit_sha}),z=a(e=>"live"===e.targetMode&&"starting"===e._sandboxState)&&!!G;(0,i.useEffect)(()=>{z&&D()},[D,z]);let J=(0,s.c3)(18e5);return(0,n.jsxs)(R.Provider,{value:B,children:[(0,n.jsx)(L,{}),(0,n.jsx)(U,{}),"live"===g&&(0,n.jsx)(N,{}),"live"===f&&"error"!==h&&!J&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(F,{}),(0,n.jsx)(q,{}),(0,n.jsx)(Z,{}),(0,n.jsx)(W,{onStarted:O,onFatalError:j,onTransientError:A,onInactivityTimeout:E})]}),t]})}function j(){let e=(0,i.useContext)(R);if(!e)throw Error("usePreviewContext must be used within a PreviewProvider");return e}function D(e){let{store:t}=j();return t(e)}function P(){let e=D(e=>e.baseUrls.live);return(0,i.useMemo)(()=>{if(!e)return null;let t=new URL(e);return C("".concat(t.protocol,"//").concat(t.host))},[e])}let O=async e=>{let t;try{if(!(t=await fetch("".concat(e,"_sandbox/dev-server"),{})).ok)return"offline"}catch(e){return"unknown"}try{let e=await t.json();switch(e.state){case"error":case"stopped":case"stopping":case"disabled":case"starting":case"started":case"disabled":return e.state;default:return c.logging.error("unexpected_dev_server_state",{state:e.state}),"unknown"}}catch(e){return c.logging.debug("malformed_dev_server_state_response",{error:e}),"error"}};function L(){let e=j().refs[M.i.STATIC],t=(0,k.iZ)(e=>{var t;return null===(t=e.project)||void 0===t?void 0:t.preview_build_commit_sha}),r=(0,i.useRef)(t);return(0,i.useEffect)(()=>{if(t&&r.current&&t!==r.current){var n;null===(n=e.current)||void 0===n||n.reload()}r.current=t},[t,e]),null}function N(){let e=j().refs[M.i.LIVE];return(0,i.useEffect)(()=>{var t;null===(t=e.current)||void 0===t||t.reload()},[e]),null}function U(){let e=D(e=>e.targetMode),t=j().startLiveMode,r=(0,I.bk)(e=>e.isSendChatMessageMutationPending);return(0,i.useEffect)(()=>{r&&"static"===e&&t()},[r,e,t]),null}function q(){let e=D(e=>e._isSandboxStateStale),t=j().store;return(0,i.useEffect)(()=>{if(e)return;let r=setTimeout(()=>{t.setState(e=>{e._isSandboxStateStale=!0})},"starting"===t.getState()._sandboxState?250:1e4);return()=>clearTimeout(r)},[e,t]),null}function F(){let e=j().store;return(0,i.useEffect)(()=>{e.setState(e=>{e._isSandboxStateStale||(e._isSandboxStateStale=!0)})},[e]),null}function Z(){let e=j().store;return(0,i.useEffect)(()=>{let t=()=>{"visible"===document.visibilityState&&e.setState(e=>{e._isSandboxStateStale||(e._isSandboxStateStale=!0)})};return document.addEventListener("visibilitychange",t),()=>document.removeEventListener("visibilitychange",t)},[e]),null}function W(e){let{onStarted:t,onTransientError:r,onFatalError:n,onInactivityTimeout:a}=e,s=D(e=>e._isSandboxStateStale),o=j().store;return(0,i.useEffect)(()=>{if(!s)return;let e=!0;return async function(){try{let s=o.getState().baseUrls.live;if(!s)return;let i=await O(s);if(!e)return;switch(i){case"offline":a();case"error":n();break;case"unknown":case"stopped":r();break;case"started":t()}}finally{if(!e)return;o.setState(e=>{e._isSandboxStateStale=!1})}}(),()=>{e=!1}},[s,n,r,t,a,o]),null}function V(e){let{baseUrl:t,path:r}=e;if(!t)return null;let n=t.endsWith("/")?t.slice(0,-1):t,a=r.startsWith("/")?r:"/".concat(r);return"".concat(n).concat(a)}let B=e=>{let{data:t}=(0,a.a)({queryKey:["projects",e,"accessToken"],queryFn:async()=>{let t=(0,v.SJ)(),{token:r}=await t.get("/projects/".concat(e,"/auth-token"));return r},enabled:!!e});return t},G=(0,i.forwardRef)((e,t)=>{let{url:r,useCustomScript:a,onNavigate:s,onMessage:o,id:l}=e,u=(0,i.useRef)(null),[c,g]=(0,i.useState)(null),[f,m]=(0,i.useState)(!0),p=(0,k.iZ)(e=>e.project),v=B(null==p?void 0:p.id),h=!!(null==p?void 0:p.id)&&!(null==p?void 0:p.is_protected)||!!v,_=c&&h?x(c,{useCustomScript:a,accessToken:v}):null;return(0,i.useImperativeHandle)(t,()=>({reload(){u.current&&(u.current.src=_||u.current.src)}}),[_]),(0,i.useEffect)(()=>{if(u.current&&r&&r!==c&&h){let e=x(r,{useCustomScript:a,accessToken:v});g(r),m(!0),u.current.src=e}},[v,h,c,s,r,a]),(0,i.useEffect)(()=>{let e=e=>{var t;if((null===(t=u.current)||void 0===t?void 0:t.contentWindow)===e.source){if("URL_CHANGED"===e.data.type){if(e.data.url!==c&&(g(e.data.url),e.data.url)){let{pathname:t,search:r,hash:n}=new URL(e.data.url),a=t;r&&(a+=r),n&&(a+=n),s(a)}}else"404"===e.data?m(!1):o(e)}};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)},[c,o,s]),(0,n.jsxs)(n.Fragment,{children:[f&&(0,n.jsx)(w,{isLoading:!0}),(0,n.jsx)("iframe",{sandbox:d.h,ref:u,id:l,className:"min-h-full w-full flex-grow",allow:"accelerometer; autoplay; camera; encrypted-media; fullscreen; geolocation; gyroscope; microphone; midi; clipboard-read; clipboard-write; payment; usb; vr; xr-spatial-tracking; screen-wake-lock; magnetometer; ambient-light-sensor; battery; gamepad; picture-in-picture; display-capture; bluetooth;",onLoad:()=>m(!1),onError:()=>{m(!1)}})]})});G.displayName="PreviewIframe";let z=e=>"".concat(e,"-preview-panel");function J(e){let t=z(e);return(0,i.memo)(function(){let r=D(t=>t.activeMode===e),a=D(e=>e.currentPath),[s,o]=(0,i.useState)(a);(0,i.useEffect)(()=>{r&&o(a)},[r,a]);let{fullUrl:l,customScript:u}=D(t=>({fullUrl:V({baseUrl:t.baseUrls[e],path:s}),customScript:t.customScript})),d=(0,i.useMemo)(()=>l,[l]),{store:h}=j(),b=j().refs[e],E=(0,p.D)(),w=(0,_.D)(),x=(0,v.SJ)(),C=(0,i.useCallback)(e=>{o(e),r&&h.setState(t=>{t.currentPath!==e&&(t.currentPath=e)})},[h,r,o]),I=(0,i.useCallback)(e=>{if(r){var t,n;if(!function(e,t){if("CONSOLE_OUTPUT"!==e.data.type)return;let r=[];if(Array.isArray(e.data.messages))e.data.messages.forEach(t=>{"object"==typeof t&&null!==t&&"string"==typeof t.message&&"string"==typeof t.level?r.push({level:t.level,message:t.message.length>1e4?t.message.slice(0,1e4):t.message,logged_at:t.logged_at||e.data.logged_at||new Date().toISOString()}):c.logging.warn("Received invalid message format within messages array",{msgData:t})});else if("string"==typeof e.data.message&&"string"==typeof e.data.level)r.push({level:e.data.level,message:e.data.message.length>1e4?e.data.message.slice(0,1e4):e.data.message,logged_at:e.data.logged_at||new Date().toISOString()});else{c.logging.warn("Received invalid CONSOLE_OUTPUT data format",{data:e.data});return}t(e=>{r.length>50?e.consoleLogs=r.slice(0,50):e.consoleLogs.push(...r);let t=f(e.consoleLogs);for(;t>1e4||e.consoleLogs.length>50;){let r=e.consoleLogs.shift();if(!r)break;t-=r.message.length}})}(e,h.setState),t=h.setState,"NETWORK_REQUEST"===e.data.type&&t(t=>{let r={...e.data.request};r.responseBody&&r.responseBody.length>1e4&&(r.responseBody=r.responseBody.slice(0,1e4)),r.requestBody&&r.requestBody.length>1e4&&(r.requestBody=r.requestBody.slice(0,1e4)),r.error&&(r.error.message&&r.error.message.length>1e4&&(r.error.message=r.error.message.slice(0,1e4)),r.error.stack&&r.error.stack.length>1e4&&(r.error.stack=r.error.stack.slice(0,1e4))),r.url&&r.url.length>1e4&&(r.url=r.url.slice(0,1e4)),r.statusText&&r.statusText.length>1e4&&(r.statusText=r.statusText.slice(0,1e4)),t.networkRequests.push(r);let n=t.networkRequests.reduce((e,t)=>e+g(t),0);for(;n>1e5||t.networkRequests.length>50;){let e=t.networkRequests.shift();if(!e)break;n-=g(e)}}),n=h.setState,"RRWEB_EVENT"===e.data.type&&n(t=>{for(t.rrwebEvents.push(e.data.event);t.rrwebEvents.length>60;)t.rrwebEvents.shift()}),"RUNTIME_ERROR"===e.data.type||"UNHANDLED_PROMISE_REJECTION"===e.data.type)w.addRuntimeError(e.data.error,e.data.type);else if("FETCH_ERROR"===e.data.type){let t=y.W.safeParse(e.data.error),r=t.success?t.data:e.data.error;t.error&&c.logging.error("error_parsing_fetch_error",{error:t.error,event_data:e.data}),"status"in r&&(null==r?void 0:r.status)>=400&&(null==r?void 0:r.status)<500?(0,m.e)({...r,error_type:S.N.HTTP_CLIENT_ERROR},E,x):(0,m.e)({...r,error_type:S.N.HTTP_SERVER_ERROR},E,x)}}},[r,h,w,E,x]);return(0,n.jsx)(G,{ref:b,id:t,url:d,useCustomScript:u,onNavigate:C,onMessage:I})})}let H=J("static"),K=J("live")},27613:function(e,t,r){r.d(t,{H:function(){return n},i:function(){return a}});let n={mobile:{name:"mobile",tooltip:"Show desktop preview",icon:"devices"},tablet:{name:"tablet",tooltip:"Show mobile preview",icon:"devices"},desktop:{name:"desktop",tooltip:"Show tablet preview",icon:"devices"}},a={STATIC:"static",LIVE:"live"}},20958:function(e,t,r){r.d(t,{$:function(){return c},C:function(){return g}});var n=r(57437),a=r(92850),s=r(2265),i=r(59625),o=r(2043),l=r(79804);let u=()=>(0,i.Ue)(()=>({repoAccessibilityResponse:void 0})),d=(0,s.createContext)(null),c=e=>{let{children:t,projectId:r}=e,i=(0,s.useRef)(u()),c=(0,s.useMemo)(()=>({store:i.current}),[]),{canEdit:g,isProjectAdmin:f}=(0,o.t)(),{data:m}=(0,a.a)(l.V.repoAccessibility({projectId:r,userProjectPermissions:{admin:f,edit:g}}));return(0,s.useEffect)(()=>{i.current&&i.current.setState(e=>({...e,repoAccessibilityResponse:m}))},[m]),(0,n.jsx)(d.Provider,{value:c,children:t})};function g(){let{store:e}=function(){let e=(0,s.useContext)(d);if(!e)throw Error("useRepoAccessibility must be used within a RepoAccessibilityProvider");return e}();return e(e=>e.repoAccessibilityResponse)}},52055:function(e,t,r){r.d(t,{o:function(){return c}});var n=r(57437),a=r(99376),s=r(38706),i=r(82176),o=r(62869),l=r(26110),u=r(10531),d=r(41135);function c(e){let{open:t,onOpenChange:r}=e,c=(0,a.useRouter)(),g=(0,s.T_)("AuthDialog"),f=(0,i.dl)(u.P.GetStartedForFree);return(0,n.jsx)(l.Vq,{open:t,onOpenChange:r,children:(0,n.jsxs)(l.cZ,{className:"gap-4",size:"sm",children:[(0,n.jsxs)("div",{className:"flex flex-col items-start gap-4",children:[(0,n.jsx)(d.xx,{className:"h-9"}),(0,n.jsxs)(l.fK,{children:[(0,n.jsx)(l.$N,{className:"text-3xl",children:g("title")}),(0,n.jsx)(l.Be,{children:g("description")})]})]}),(0,n.jsxs)("div",{className:"mt-4 flex flex-col gap-3",children:[(0,n.jsx)(o.z,{onClick:()=>c.push("/login"),className:"w-full",variant:"outline",children:g("logIn")}),(0,n.jsx)(o.z,{onClick:()=>c.push("/signup"),className:"w-full",children:g(f?"getStartedForFree":"signUp")})]})]})})}},55157:function(e,t,r){r.d(t,{r:function(){return s}});var n=r(99376),a=r(2265);let s=()=>{let e=(0,n.useRouter)(),t=(0,n.usePathname)(),r=(0,n.useSearchParams)();return{activeTab:r.get("settings"),openSettings:(0,a.useCallback)(function(n){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=new URLSearchParams(r);n?s.set("settings",n):s.set("settings","");let i="".concat(t,"?").concat(s.toString());a?e.replace(i):e.push(i)},[t,e,r]),closeSettings:(0,a.useCallback)(()=>{let n=new URLSearchParams(r);n.delete("settings"),e.push("".concat(t,"?").concat(n.toString()))},[t,e,r])}}},57054:function(e,t,r){r.d(t,{J2:function(){return o},xo:function(){return l},xp:function(){return u},yk:function(){return d}});var n=r(57437),a=r(27312),s=r(2265),i=r(94508);let o=a.fC,l=a.xz;a.ee;let u=a.x8,d=s.forwardRef((e,t)=>{let{className:r,align:s="center",sideOffset:o=4,...l}=e;return(0,n.jsx)(a.h_,{children:(0,n.jsx)(a.VY,{ref:t,align:s,sideOffset:o,className:(0,i.cn)("z-[10000] w-72 rounded-xl border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...l})})});d.displayName=a.VY.displayName},53647:function(e,t,r){r.d(t,{Bw:function(){return p},DI:function(){return d},Ph:function(){return u},Ql:function(){return h},U$:function(){return _},i4:function(){return g},ki:function(){return c},n5:function(){return v}});var n=r(57437),a=r(20653),s=r(56873),i=r(2265),o=r(57346),l=r(94508);let u=s.fC,d=s.ZA,c=s.B4,g=i.forwardRef((e,t)=>{let{className:r,children:a,...i}=e;return(0,n.jsxs)(s.xz,{ref:t,className:(0,l.cn)("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r),...i,children:[a,(0,n.jsx)(s.JO,{asChild:!0,children:(0,n.jsx)(o.Z,{name:"keyboard_arrow_down",size:"small",className:"opacity-50"})})]})});g.displayName=s.xz.displayName;let f=i.forwardRef((e,t)=>{let{className:r,...i}=e;return(0,n.jsx)(s.u_,{ref:t,className:(0,l.cn)("flex cursor-default items-center justify-center py-1",r),...i,children:(0,n.jsx)(a.g8U,{className:"h-4 w-4"})})});f.displayName=s.u_.displayName;let m=i.forwardRef((e,t)=>{let{className:r,...i}=e;return(0,n.jsx)(s.$G,{ref:t,className:(0,l.cn)("flex cursor-default items-center justify-center py-1",r),...i,children:(0,n.jsx)(a.v4q,{className:"h-4 w-4"})})});m.displayName=s.$G.displayName;let p=i.forwardRef((e,t)=>{let{className:r,children:a,position:i="popper",...o}=e;return(0,n.jsx)(s.h_,{children:(0,n.jsxs)(s.VY,{ref:t,className:(0,l.cn)("relative z-[10000] max-h-96 min-w-32 overflow-hidden rounded-md border bg-card text-card-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:i,...o,children:[(0,n.jsx)(f,{}),(0,n.jsx)(s.l_,{className:(0,l.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),(0,n.jsx)(m,{})]})})});p.displayName=s.VY.displayName;let v=i.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)(s.__,{ref:t,className:(0,l.cn)("px-2 py-1.5 text-sm font-medium",r),...a})});v.displayName=s.__.displayName;let h=i.forwardRef((e,t)=>{let{className:r,children:i,...o}=e;return(0,n.jsxs)(s.ck,{ref:t,className:(0,l.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",r),...o,children:[(0,n.jsx)("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,n.jsx)(s.wU,{children:(0,n.jsx)(a.nQG,{className:"h-4 w-4"})})}),(0,n.jsx)(s.eT,{children:i})]})});h.displayName=s.ck.displayName;let _=i.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)(s.Z0,{ref:t,className:(0,l.cn)("-mx-1 my-1 h-px bg-muted",r),...a})});_.displayName=s.Z0.displayName},76818:function(e,t,r){r.d(t,{g:function(){return i}});var n=r(57437),a=r(2265),s=r(94508);let i=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("textarea",{className:(0,s.cn)("flex w-full rounded-md bg-muted px-2 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...a})});i.displayName="Textarea"},98015:function(e,t,r){r.d(t,{e:function(){return s}});var n=r(21288);r(83079);var a=(0,r(12119).$)("da2287705922bbaa0f34883f5fb3e5ba79e3e1b9");async function s(e,t,r){try{let s=await a(e);if(!s){n.logging.debug("skipping_reporting_error",{error:e,err_message:e.message});return}let i=s.error_type;await r.post("/projects/".concat(t,"/report_error"),{message:null==s?void 0:s.message,error_type:i,meta_data:s})}catch(e){n.logging.error("failed_to_report_intercepted_error",{error:e})}}},94949:function(e,t,r){r.d(t,{F:function(){return s}});var n=r(2265),a=r(26034);let s=()=>({upload:(0,n.useCallback)(async e=>{let{fileName:t,file:r,options:n,continueOnError:s=!0}=e;return(0,a.cT)(t,r,n,s)},[]),download:(0,n.useCallback)(async e=>(0,a.Sv)(e),[])})},65666:function(e,t,r){r.d(t,{D:function(){return s},v:function(){return a}});var n=r(99376);let a=()=>{let e=(0,n.useParams)().project_id;return e&&"string"==typeof e?e:null},s=()=>{let e=a();if(!e)throw Error("Project ID is required and should always be set here");return e}},72253:function(e,t,r){r.d(t,{I:function(){return g},S:function(){return d}});var n=r(92850),a=r(29827),s=r(2265),i=r(14438),o=r(91351),l=r(49131),u=r(97318);let d=e=>{let{workspaceId:t}=e,{data:r,isLoading:a}=(0,n.a)({queryKey:u.E.supabaseOrganizations(t),queryFn:async()=>{let e=(0,l.SJ)();return await e.get("/workspaces/".concat(t,"/supabase-organizations"))},enabled:!!t}),s=!r||0===r.length;return{supabaseOrganizations:r,isLoading:a,noOrganizations:s}},c=o.Ry({type:o.i0("supabaseAuth"),success:o.O7(),error:o.Z_().optional()}),g=e=>{let{workspaceId:t,onConnectSuccess:r}=e,n=(0,a.NL)();(0,s.useEffect)(()=>{let e=async e=>{if(e.origin!==window.location.origin)return;let a=c.safeParse(e.data);a.success&&(a.data.success?(i.Am.success("Connection Successful",{description:"Your Supabase organization has been linked to your workspace. Select a project to finish the setup."}),await n.invalidateQueries({queryKey:u.E.supabaseOrganizations(t)}),null==r||r()):i.Am.error("Connection Failed",{description:a.data.error||"Failed to connect to Supabase. Please try again."}))};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}},[n,t,r])}},2043:function(e,t,r){r.d(t,{t:function(){return d}});var n=r(52558),a=r(60256),s=r(6812),i=r(7455),o=r(77113),l=r(71759),u=r(20984);let d=()=>{let e=(0,o.iZ)(e=>e.project),t=(0,l.hO)(e=>e.projectWorkspace),{authUser:r,isAuthenticated:d}=(0,n.Eu)(),{userData:c}=(0,a.SE)(),g=(0,i.c)(e=>e.accessLevel),f=(0,l.hO)(e=>e.memberships).find(e=>e.user_id===(null==r?void 0:r.uid)),m=(0,l.hO)(e=>e.isLoading),p=(0,s.Q)(e=>e.workspaces).some(t=>t.id===(null==e?void 0:e.workspace_id)),v=t&&t.owner_id===(null==r?void 0:r.uid)||(null==f?void 0:f.role)==="owner",h=(null==f?void 0:f.role)==="admin"||v,_=(null==e?void 0:e.user_id)&&(null==e?void 0:e.user_id)===(null==r?void 0:r.uid)||(null==c?void 0:c.is_admin)||(null==e?void 0:e.user_id)==="claimable"||g===u.u.ADMIN||(null==f?void 0:f.role)==="admin"||v,S=g===u.u.WRITE||(null==f?void 0:f.role)==="member"||_,y=e&&r&&e.user_id===r.uid,b=g===u.u.READ||(null==f?void 0:f.role)==="member"||S||(null==e?void 0:e.visibility)==="public";return{isProjectAdmin:_,canEdit:S,isProjectOwner:y,isWorkspaceOwner:v,isLoading:d&&!r||!e||m&&p,isWorkspaceMember:!!f,isWorkspaceAdmin:h,canRead:b}}},26034:function(e,t,r){r.d(t,{Sv:function(){return i},_c:function(){return o},cT:function(){return s}});var n=r(49131),a=r(21288);let s=async function(e,t,s){var i,o;let l=!(arguments.length>3)||void 0===arguments[3]||arguments[3],u=null!==(i=null==s?void 0:s.maxFileSize)&&void 0!==i?i:3145728,d=null!==(o=null==s?void 0:s.maxDimension)&&void 0!==o?o:2e3,c=t;if(t.type.startsWith("image/")){let e=new Image;if(e.src=URL.createObjectURL(t),await new Promise(t=>e.onload=t),t.size>u||Math.max(e.width,e.height)>d)try{let{default:e}=await r.e(4937).then(r.bind(r,24937));c=await e(t,{maxSizeMB:u/1024/1024,maxWidthOrHeight:Math.min(d,1920),useWebWorker:!0})}catch(e){if(a.logging.error("Error compressing image:",{error:e}),!l)throw e}}let g={file_name:e,content_type:c.type,status:"uploading"},f=await (0,n.SJ)().post("/files/generate-upload-url",g),m=await fetch(f.url,{method:"PUT",body:c,headers:{"Content-Type":c.type}});if(!m.ok){let t=Error("Upload failed with status ".concat(m.status));if(a.logging.error("File upload failed:",{fileName:e,status:m.status}),!l)throw t}},i=async e=>(0,n.SJ)().post("/files/generate-download-url",e),o=async e=>(0,n.SJ)().post("/files/generate-public-url",e)},24032:function(e,t,r){r.d(t,{qG:function(){return y},Eh:function(){return E},WR:function(){return b}});var n=r(57437),a=r(2265),s=r(59625),i=r(89651),o=r(14438),l=r(52558),u=r(94949);let d=async(e,t)=>{let r=await fetch(e),n=await r.blob();return new File([n],t,{type:n.type})},c=e=>{let{upload:t}=(0,u.F)(),{isAuthenticated:r}=(0,l.Eu)(),n=e(e=>e.setImages),s=(0,a.useCallback)(async e=>{if(!r)return;let a=e.filter(e=>!e.uploaded&&!e.uploading);if(0===a.length)return;n(e=>e.map(e=>a.some(t=>t.id===e.id)?{...e,uploading:!0}:e));let s=a.map(async e=>{let r=await d(e.url,e.name);return await t({fileName:e.id,file:r,continueOnError:!0}),e.id}),i=new Set((await Promise.allSettled(s)).filter(e=>"fulfilled"===e.status).map(e=>e.value)),l=new Set(a.filter(e=>!i.has(e.id)).map(e=>e.id));l.size>0&&o.Am.error("Image upload failed",{description:"Failed to upload ".concat(l.size," file").concat(l.size>1?"s":"",". Removing failed uploads.")}),n(e=>e.filter(e=>!l.has(e.id)).map(e=>a.some(t=>t.id===e.id)?{...e,uploading:!1,uploaded:i.has(e.id)}:e))},[t,n,r]);return(0,a.useEffect)(()=>{if(r){let t=e.getState().images;t.filter(e=>!e.uploaded&&!e.uploading).length>0&&s(t)}},[r,s,e]),{uploadImages:s}},g={message:"",images:[],imagesAddedViaDropdown:!1,suggestionLabel:void 0,wasCleared:!1},f=e=>({id:e.id,url:e.url,name:e.name,uploaded:e.uploaded}),m=e=>({id:e.id,url:e.url,name:e.name,uploading:!1,uploaded:e.uploaded}),p=async e=>{try{return(await fetch(e)).ok}catch(e){return!1}},v=(e,t)=>{let r=e(e=>e.setMessage),n=e(e=>e.setSuggestionLabel),s=e(e=>e.setImages),o=e(e=>e.setImagesAddedViaDropdown),{uploadImages:l}=c(e),u=(0,a.useRef)(!1),[d,v]=(0,i.Z)("editor-store-".concat(t),{defaultValue:g,storageSync:!1});(0,a.useEffect)(()=>{v(e=>{if(!e.wasCleared){let{message:t,images:a,imagesAddedViaDropdown:i,suggestionLabel:l}=e;Promise.all(a.map(async e=>e.url.startsWith("blob:")?await p(e.url)?e:null:e)).then(e=>{let a=e.filter(e=>null!==e).map(m);r(t),n(l),s(a),o(i)})}return e})},[t,s,o,r,n,v]);let h=(0,a.useCallback)(e=>{v(t=>{if(u.current)return u.current=!1,t;let r={message:e.message,images:e.images.map(f),imagesAddedViaDropdown:e.imagesAddedViaDropdown,suggestionLabel:e.suggestionLabel,wasCleared:!1};return l(e.images),r})},[v,l]);return(0,a.useEffect)(()=>e.subscribe(h),[e,h]),{clearEditorState:(0,a.useCallback)(()=>{u.current=!0,v(e=>({...e,wasCleared:!0})),e.getState().clearEditorState()},[v,e]),restoreEditorState:(0,a.useCallback)(()=>{v(e=>{if(e.wasCleared){let{message:t,images:a,imagesAddedViaDropdown:i,suggestionLabel:l}=e,u=a.map(m);return r(t),n(l),s(u),o(i),{...e,wasCleared:!1}}return e})},[v,r,n,s,o]),setStorageData:v}},h={message:"",images:[],imagesAddedViaDropdown:!1,suggestionLabel:void 0},_=()=>(0,s.Ue)(e=>({...h,setMessage:t=>{e({message:t,suggestionLabel:void 0})},setSuggestionLabel:t=>{e({suggestionLabel:t})},setImages:t=>{Array.isArray(t)?0===t.length?e({images:t,imagesAddedViaDropdown:!1}):e({images:t}):e(e=>{let r=t(e.images);return 0===r.length?{images:r,imagesAddedViaDropdown:!1}:{images:r}})},setImagesAddedViaDropdown:t=>{e({imagesAddedViaDropdown:t})},clearEditorState:()=>{e(h)}})),S=(0,a.createContext)(null),y=e=>{let{children:t,localStorageKey:r}=e,s=(0,a.useRef)(_()),{clearEditorState:i,restoreEditorState:o,setStorageData:l}=v(s.current,r),u=(0,a.useMemo)(()=>({store:s.current,clearEditorState:i,restoreEditorState:o,setStorageData:l}),[i,o,l]);return(0,n.jsx)(S.Provider,{value:u,children:t})};function b(){let e=(0,a.useContext)(S);if(!e)throw Error("useEditorStore must be used within an EditorStoreProvider");return e}function E(e){let{store:t}=b();return t(e)}},22076:function(e,t,r){r.d(t,{m:function(){return m},D:function(){return p}});var n=r(57437),a=r(2265),s=r(59625),i=r(98015),o=r(65666),l=r(21288),u=r(91351);let d=u.Ry({message:u.Z_().min(1),stack:u.Z_().optional(),filename:u.Z_().optional(),lineno:u.Rx().optional(),colno:u.Rx().optional(),blankScreen:u.O7().optional()});var c=r(49131);let g=()=>(0,s.Ue)(()=>({runtimeErrors:[],latestBuildTimestamp:0})),f=(0,a.createContext)({store:g(),clearDiagnostics:()=>{},clearBlankScreenErrors:()=>{},updateLatestBuildTimestamp:()=>{},addRuntimeError:()=>{throw Error("ProjectDiagnostics must be used within a ProjectDiagnosticsProvider")}}),m=e=>{let{children:t}=e,r=(0,o.v)();if(!r)throw Error("Project ID is required and should always be set here");let s=(0,a.useRef)();s.current||(s.current=g());let u=(0,c.SJ)(),m={store:s.current,clearDiagnostics:()=>{s.current.setState({runtimeErrors:[]})},addRuntimeError:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"RUNTIME_ERROR",n=function(e){let t=d.safeParse(e);return t.success?(t.data.stack||l.logging.warn("diagnostics.runtime_error.stack_missing",{parse_error:t.error,error_data:e}),t.data.filename||l.logging.warn("diagnostics.runtime_error.filename_missing",{parse_error:t.error,error_data:e}),t.data):(l.logging.error("diagnostics.runtime_error.invalid",{parse_error:t.error,error_data:e}),null)}(e);if(!n)return;n.blankScreen&&(0,i.e)({...n,error_type:"runtime"},r,u).catch(e=>{l.logging.error("error_reporting_runtime_error",{error:e})});let a=s.current,o=function(e,t){let r={timestamp:Date.now(),error_type:e,message:t.message||"Unknown error",filename:t.filename||"Unknown file",lineno:t.lineno||0,colno:t.colno||0,stack:t.stack||"Unavailable",has_blank_screen:(null==t?void 0:t.blankScreen)||!1};return r.message.length>1e4&&(r.message=r.message.slice(0,1e4)),r.stack.length>1e4&&(r.stack=r.stack.slice(0,1e4)),r}(t,n);a.setState(e=>{let t=[...e.runtimeErrors],r=t.findIndex(e=>0==e.lineno?e.message===o.message:e.filename===o.filename&&e.colno===o.colno&&e.lineno===o.lineno);-1!==r&&t.splice(r,1),t.push(o);let n=t.reduce((e,t)=>e+v(t),0);for(;n>1e5||t.length>50;){let e=t.shift();if(!e)break;n-=v(e)}return{runtimeErrors:t}})},updateLatestBuildTimestamp:e=>{let t=s.current;e>t.getState().latestBuildTimestamp&&t.setState({latestBuildTimestamp:e})},clearBlankScreenErrors:()=>{let e=s.current;e.setState({runtimeErrors:e.getState().runtimeErrors.filter(e=>!e.has_blank_screen)})}};return(0,n.jsx)(f.Provider,{value:m,children:t})};function p(){return(0,a.useContext)(f)}let v=e=>{var t,r,n,a,s,i;return((null===(t=e.error_type)||void 0===t?void 0:t.length)||0)+((null===(r=e.message)||void 0===r?void 0:r.length)||0)+((null===(n=e.filename)||void 0===n?void 0:n.length)||0)+((null===(a=e.lineno)||void 0===a?void 0:a.toString().length)||0)+((null===(s=e.colno)||void 0===s?void 0:s.toString().length)||0)+((null===(i=e.stack)||void 0===i?void 0:i.length)||0)}},79804:function(e,t,r){r.d(t,{V:function(){return i}});var n=r(52274),a=r(49131),s=r(97318);let i={repoAccessibility:e=>{let{projectId:t,userProjectPermissions:r}=e;return(0,n.C)({queryKey:s.pL.repoAccessibility(t),queryFn:async()=>(0,a.SJ)().get("/projects/".concat(t,"/repo-accessibility")),enabled:r.edit&&!!t,retry:!1})},installations:e=>{let{enabled:t}=e;return(0,n.C)({queryKey:s.pL.installations(),queryFn:()=>(0,a.SJ)().get("/users/github-installations"),enabled:t,retry:!1})}}},33187:function(e,t,r){r.d(t,{W:function(){return l},b:function(){return u}});var n=r(52274),a=r(49131),s=r(21288),i=r(20984),o=r(97318);let l={sourceCode:e=>{let{projectId:t,enabled:r}=e;return(0,n.C)({queryKey:o.iZ.sourceCode(t),queryFn:async()=>(0,a.SJ)().get("/projects/".concat(t,"/source-code")),enabled:r})},feedbackStatus:e=>{let{projectId:t}=e;return(0,n.C)({queryKey:o.iZ.feedbackStatus(t),queryFn:async()=>(0,a.SJ)().get("/user/feedback-status")})},presence:e=>{let{projectId:t,authUser:r,enablePresence:s}=e;return(0,n.C)({queryKey:o.iZ.presence(t),queryFn:()=>r?(0,a.SJ)().post("/projects/".concat(t,"/presence")):Promise.resolve(null),enabled:!!r&&!!t&&s,refetchInterval:6e4,refetchOnWindowFocus:!0,refetchOnMount:!0})},magicCode:e=>{let{projectId:t}=e;return(0,n.C)({queryKey:o.iZ.secretLinkId(t),queryFn:async()=>{let e=(0,a.SJ)(),r=(await e.get("/projects/".concat(t,"/magic-codes"))).magic_codes;return r&&0!==r.length?{id:r[0].id}:{id:null}}})},sharedWithMe:()=>(0,n.C)({queryKey:o.iZ.sharedWithMe(),queryFn:async()=>(0,a.SJ)().get("/user/projects/shared")}),collaborators:e=>{let{projectId:t,projectOwnerId:r}=e,i=(0,a.SJ)();return(0,n.C)({queryKey:o.iZ.collaborators(null!=t?t:""),enabled:!!t&&!!r,refetchInterval:6e4,queryFn:async()=>{try{var e;let n=null!==(e=await i.get("/projects/".concat(t,"/collaborators")))&&void 0!==e?e:[];return u({collaborators:n,projectOwnerId:r})}catch(e){return s.logging.error("Failed to fetch collaborators",{error:e}),[]}}})},communityProjects:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"recent",r=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;return(0,n.C)({queryKey:o.iZ.communityProjects(e,t,r,s),queryFn:async()=>(0,a.Tb)().get("".concat("/projects/community","?limit=").concat(e,"&order_by=").concat(t).concat(r&&"all"!==r?"&category=".concat(r):"").concat(s?"&start_after=".concat(s):"").concat("trending"===t?"&feature_source=trending":""))})},securityWarnings:e=>{let{projectId:t,enabled:r}=e;return(0,n.C)({queryKey:o.iZ.securityWarnings(t),queryFn:async()=>(0,a.SJ)().get("/projects/".concat(t,"/security-warnings")),enabled:r})},analytics:e=>{let{projectId:t,timePeriod:r}=e;return(0,n.C)({queryKey:o.iZ.analytics(t,r),queryFn:async()=>(0,a.SJ)().get("/projects/".concat(t,"/analytics"),{params:{startDate:r.startDate,endDate:r.endDate,granularity:r.granularity}})})},analyticsTrend:e=>{let{projectId:t}=e;return(0,n.C)({queryKey:o.iZ.analyticsTrend(t),queryFn:async()=>(0,a.SJ)().get("/projects/".concat(t,"/analytics/trend")),refetchInterval:6e4})},projectDetails:e=>{let{projectId:t}=e;return(0,n.C)({queryKey:o.iZ.projectDetails(t),queryFn:async()=>(0,a.SJ)().get("/projects/".concat(t,"/details"))})}};function u(e){let{collaborators:t,projectOwnerId:r}=e;return[...t].sort((e,t)=>{let n=r&&e.id===r,a=r&&t.id===r;return n&&!a?-1:!n&&a?1:e.access_level===i.u.ADMIN&&t.access_level!==i.u.ADMIN?-1:e.access_level!==i.u.ADMIN&&t.access_level===i.u.ADMIN?1:(e.email||"").localeCompare(t.email||"")})}},20984:function(e,t,r){var n,a;r.d(t,{u:function(){return n}}),(a=n||(n={})).ADMIN="admin",a.WRITE="write",a.READ="read",a.NONE="none"},96771:function(e,t,r){var n,a,s,i;r.d(t,{I:function(){return n}}),(s=(a=n||(n={})).type||(a.type={})).AI_UPDATE="ai_update",s.REVERT="revert",s.INITIAL="initial",s.DEVELOPER_UPDATE="developer_update",s.MANUAL_UPDATE="manual_update",(i=a.feedback||(a.feedback={})).POSITIVE="positive",i.NEGATIVE="negative",i.NO_FEEDBACK="no_feedback"},61062:function(e,t,r){var n,a;r.d(t,{N:function(){return n}}),(a=n||(n={})).IMMEDIATE_RUNTIME="immediate_runtime",a.RUNTIME="runtime",a.BUILD="build",a.DEPLOY_SUPABASE_FUNCTIONS="deploy_supabase_functions",a.HTTP_CLIENT_ERROR="http_client_error",a.CORS_ERROR="cors_error",a.HTTP_SERVER_ERROR="http_server_error",a.NO_CODE_CHANGE="no_code_change",a.CODE_DIFF="code_diff",a.FILE_EDITED_WITHOUT_PERMISSION="file_edited_without_permission",a.EXCLUDED_FILE_EDITED="excluded_file_edited",a.SUPABASE_EDGE_FUNCTION_ERROR="supabase_edge_function_error",a.DEPENDENCY_INSTALL="dependency_install",a.SUPABASE_SQL_ERROR="supabase_sql_error",a.SEARCH_REPLACE_FAILED="search_replace_failed",a.SEARCH_REPLACE_MISSING_FILE="search_replace_missing_file",a.CHANGED_MISSING_FILE="changed_missing_file",a.RENAME_FAILED="rename_failed",a.DELETION_FAILED="deletion_failed"},74541:function(e,t,r){var n,a,s;r.d(t,{r:function(){return n}}),(s=(a=n||(n={})).role||(a.role={})).AI="ai",s.USER="user",(a.tag||(a.tag={})).INSTANT_MODE_MESSAGE="instant-mode-message"},7163:function(e,t,r){r.d(t,{W:function(){return l},p:function(){return s}});var n=r(91351),a=r(61062);let s=n.Ry({frame:n.Z_().optional(),id:n.Z_().optional(),loc:n.Ry({file:n.Z_().optional(),line:n.Rx().optional(),column:n.Rx().optional()}).optional(),message:n.Z_(),plugin:n.Z_().optional(),pluginCode:n.Z_().optional(),stack:n.Z_().optional()}).transform(e=>({...e,error_type:a.N.IMMEDIATE_RUNTIME})),i=n.Ry({body:n.Z_(),message:n.Z_(),status:n.Rx(),statusText:n.Z_().optional(),url:n.Z_()}),o=n.Ry({message:n.Z_(),method:n.Km(["OPTIONS","GET","POST","PUT","DELETE","PATCH"]),origin:n.Z_().optional(),stack:n.Z_().optional(),url:n.Z_()}),l=n.G0([i,o])}}]);